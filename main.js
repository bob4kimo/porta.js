/**==================================================================================
 Main-Target
 A) Encrypt js's all function-name and variables
 B) Encrypt-name could reduce the word-length from original, make single js-size more tiny
 C) Make function-variable's length to minimum, ex:func(apple,ball)->func(a,b)
 D) Go following url for packing ur code, remove all the space from ur code
    http://dean.edwards.name/packer/
 E) If u transfer js by url or http, u need encode js into base64, otherwise base64
    will increase ur data-size
    https://stackoverflow.com/questions/201479/what-is-base-64-encoding-used-for
    
 ToDo:
 -> remove all comment
 -> remove all empty-line
 A) Encrypt-function names are generated by random alphabet char(52 chars for random)
 B) You can choose the encrypted-name's length, ex:func()->xxx() or func()->xx()
 C) If u choose encrypt-name's length is 2, then u will have 52 squared equals 2704 diff names
 D) List all ur count for encrypt-target's and random-name's, random-names must bigger than targets
=====================================================================================*/




/**--------------------------------------------------------------------------------------
 * Entry Point - main execution start from here
---------------------------------------------------------------------------------------*/
// var textBcoreJs = getBcoreJsText();
// textBcoreJs = deleteAllCommentForStr(textBcoreJs);
// textBcoreJs = deleteAllEmptyLineForStr(textBcoreJs);
// showResultOnScreen( textBcoreJs );

// NEXT: randomArr may use base64 encode char
// NEXT: first do encode within func's var







/**--------------------------------------------------------------------------------------
 * Remove all empty-line in target string
 ---------------------------------------------------------------------------------------*/
function deleteAllEmptyLineForStr(str) {
    // separate string into array by diff-line(\n), so each line will be single item
    var arrStr = str.split('\n');
    // remove item from array if it is an empty-line
    for( var i=0; i<arrStr.length; i++ ) {
        if( arrStr[i].length < 1 ) {
            arrStr.splice(i,1);
            // re-check same index item again, otherwise some item may miss
            i--;
        }
    }
    // re-combine array into single string
    return arrStr.join('\n');
}
/**--------------------------------------------------------------------------------------
 * Remove all line-comment in target string
 ---------------------------------------------------------------------------------------*/
function deleteAllCommentForStr(str) {

    while(str.indexOf('//')!==-1){
        str = deleteStrBtwKeywords(str,'//','\n');
    }

    while(str.indexOf('/*')!==-1){
        str = deleteStrBtwKeywords(str,'/*','*/');
    }

    return str;
}
/**--------------------------------------------------------------------------------------
 * Delete chars between key_start and key_end, all string-area will deleted without space
 ---------------------------------------------------------------------------------------*/
function deleteStrBtwKeywords(str,key_start,key_end) {
    var keyword     = key_start;
    var keyword_end = key_end;
    // get keyword and keyword_end's char index
    var indexFrom = str.indexOf(keyword);
    var indexTo = 0;
    var searchRange = 2500;
    // if keyword_end's string length more than 1 search-way will diff, so we need record here
    var keyword_end_length = keyword_end.length>1?keyword_end.length:0;
    // find keyword_end's char-index starts from indexFrom's index
    for( var i = indexFrom; i<indexFrom+searchRange; i++ ) {
        var searchStr = '';
        // when search-target's str-length more than 1, then we need to combine chars in loop
        if( keyword_end_length>1 ) {
            // when we need to find '*/' in looping chars, str[i] will appear '*' only,
            // based on keyword_end's str-length, searchStr=str[i]+str[i+1]+str[i+2]...
            for( var j=0; j<keyword_end_length; j++ ) {
                searchStr += str[i+j];
            }
        } else {
            // when our search-target in loop has only 1 char, then str[i] will be fine
            searchStr = str[i];
        }
        // char matches keyword_end, save with char-index it is
        if( searchStr === keyword_end ) {
            // +1 means all line will be delete, not just left single empty-line
            // +keyword_end_length means when keyword's str-length more than 1,
            // then we need to include them into count also, otherwise some ending-chars
            // will not be deleted in result
            indexTo = i+1+keyword_end_length;
            break;
        }
    }
    return deleteCharFromIndex(str,indexFrom,indexTo);
}
/**--------------------------------------------------------------------------------------
 * Chars between fromIndex and toIndex will be deleted from originalStr
 ---------------------------------------------------------------------------------------*/
function deleteCharFromIndex(originalStr,fromIndex,toIndex) {
    return originalStr.replace(originalStr.substring(fromIndex, toIndex), "");
}





/**--------------------------------------------------------------------------------------
 * Get all keyword's index from target string return array format, target must perfect
 * match to keyword.
 * -------------------------------------------------------------------------------------
 * var str = 'apple.wds;applef;sapple;napplek;apple';
 * log( getKeywordIndexArrFromStr(str,'apple') );     // [0,32]
 ---------------------------------------------------------------------------------------*/
function getKeywordIndexArrFromStr(originalStr, keyword) {
    //----- DEPRECATED -------
    // for (var pos = str.indexOf(keyword); pos !== -1; pos = str.indexOf(keyword, pos + 1)) {
    //     arrKeywordIndex.push(pos);
    //----- DEPRECATED -------

    // array for recording index, return answer
    var arrKeywordIndex = [];
    // copy original string to temp, temp-str will do some modify, content will change
    var tempStr = originalStr;
    // regular expression for perfect match keyword
    var regex = new RegExp('\\b' + keyword + '\\b');
    // for blocking the keyword we already in count
    var keywordMask = '';
    // generate keyword-mask, for blocking the keyword in string
    for( var i=0; i<keyword.length; i++ ) {
        keywordMask += 'x';
    }

    // for recording current keyword-index
    var keywordIndex = -1;
    // search whole string to find keyword-index, if exist save index to var and return true
    function isKeywordInsideStr(str) {
        keywordIndex = str.search(regex);
        return keywordIndex>-1;
    }

    // when there is still keyword inside tempStr, keep searching
    while( isKeywordInsideStr(tempStr) ) {
        // keyword-index exist, save into array
        arrKeywordIndex.push(keywordIndex);
        // overwrite keyword to "keywordMask", so searching will not find repeated index,
        // this index we have saved it, break-down this keyword and looping will find next new index
        tempStr = replaceStrAt(tempStr,keywordIndex,keyword,keywordMask);
    }

    return arrKeywordIndex;
}





/**--------------------------------------------------------------------------------------
 * Replace keyword to new one in string
 * -------------------------------------------------------------------------------------
 * originalStr: ur main string
 * startIndex:  replace-target's char index
 * targetStr:   replace-target's string
 * replaceStr:  new string we are going to replaced
 * -------------------------------------------------------------------------------------
 * var mainStr = 'This is an apple.';
 * log( replaceStrAt(mainStr,11,'apple','orange') );      // This is an orange.
 ---------------------------------------------------------------------------------------*/
function replaceStrAt(originStr, startIndex, targetStr, replaceStr) {
    var charSpace = targetStr.length;
    return originStr.substring(0, startIndex) + replaceStr + originStr.substring(startIndex + charSpace, originStr.length);
}





/**--------------------------------------------------------------------------------------
 * Make random-name array for replacing function or variable, return name array
 * --------------------------------------------------------------------------------------
 * nameLength: each name's length, ex:nameLength=2 name=xx, nameLength=3 name=xxx
 * arrCount: how many name in this arr u are going to make
---------------------------------------------------------------------------------------*/
function getRandomNameArr(nameLength, arrCount) {
    //----- we have 52 chars in arr, random-name's char will based on those chars -----//
    var arrAlphabet = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    //----- make sure target-string do not exist in this arr -----//
    function isStrInsideArr(arr, targetStr) {
        var isFound = false;
        for (var i = 0; i < arr.length && !isFound; i++) {
            if (arr[i] === targetStr) {
                isFound = true;
            }
        }
        return isFound;
    }
    //----- get a random int from a range, ex:0~51 for arrAlphabet ------//
    function getRandomIntBetween(start, end) {
        return Math.floor(Math.random() * end) + start;
    }
    //----- get a random alphabet-char from arrAlphabet ------//
    function getRandomAlphabet() {
        return arrAlphabet[getRandomIntBetween(0, 51)];
    }
    //----- get a random string by str-length, if length=2, ans=as,jy,wp... ------//
    function getRandomNameByLength(length) {
        var ans = '';
        for (var i = 0; i < length; i++) {
            ans = ans.concat(getRandomAlphabet());
        }
        return ans;
    }
    
    var arr = [];
    for (var i = 0; i < arrCount; i++) {
        var name = getRandomNameByLength(nameLength);
        //----- make sure new-name always new not repeated -----//
        if (!isStrInsideArr(arr, name)) {
            arr.push(name);
        } else {
            //----- if name repeated, get a new random again -----//
            i--;
        }
    }
    return arr;
}








function isCharAlphabet(char) {
    return isStrInsideArr(arrAlphabet, char);
}


function getKeywordNextChar(allString, keyword, keywordIndex) {
    //        return allString.substring(keywordIndex+keyword.length,keywordIndex+keyword.length+1);
    var ans = '';
    var scanCharDis = 10;
    var keywordLength = keyword.length;
    var arr = [];
    for (var i = 0; i < scanCharDis; i++) {
        arr.push(allString.substring(keywordIndex + keywordLength, keywordIndex + keywordLength + 1 + i))
    }
    for (i = 0; i < arr.length; i++) {
        var v = arr[i];
        //----- when char not 'space' and 'changeLine' -----//
        if (!(v.indexOf(' ') > -1) && !(v.indexOf('\n') > -1) && !(v.indexOf('-') > -1)) {
            ans = v;
            break;
        }
    }
    //        log(ans);
    return ans;
}

function getKeywordPreviousChar(allString, keywordIndex) {
    //        return allString.substring(keywordIndex - 1, keywordIndex);
    var ans = '';
    var scanCharDis = 50;
    var arr = [];
    for (var i = 0; i < scanCharDis; i++) {
        if (i > 0)
            arr.push(allString.substring(keywordIndex - (i), keywordIndex));
    }
    for (i = 0; i < arr.length; i++) {
        var v = arr[i];
        //----- when char not 'space' and 'changeLine' -----//
        if (!(v.indexOf(' ') > -1) && !(v.indexOf('\n') > -1) && !(v.indexOf('-') > -1) && v.length > 0) {
            ans = v;
            break;
        }
    }
    return ans;
}














function encryptBcoreJs(localFile, func) {

    //----- core's all keyword -----//
    var arr1 = getCoreFuncNameArr();
    var arr2 = getCoreProtoNameArr();
    arr1.push.apply(arr1, arr2);

    func(arr1);





    function getCoreProtoNameArr() {
        var arrTemp1 = [];
        var arrTemp2 = [];
        var tempVar1 = '';
        var tempVar2 = '';
        var countIndex = 0;
        arrTemp1 = localFile.split('\n');
        arrTemp1.forEach(function (v) {
            if (v.indexOf('Sprite.prototype.') === 0) {
                arrTemp2.push(v);
            }

        });
        arrTemp1 = [];
        arrTemp2.forEach(function (v) {
            arrTemp1.push(v.split('Sprite.prototype.')[1]);
        });
        arrTemp2 = [];
        arrTemp1.forEach(function (v) {
            arrTemp2.push(v.split(' =')[0]);
        });
        return arrTemp2;
    }






    function getCoreFuncNameArr() {
        var arrTemp1 = [];
        var arrTemp2 = [];
        var tempVar1 = '';
        var tempVar2 = '';
        //----- extra all function name without prototype-name -----//
        arrTemp1 = localFile.split('\n');
        arrTemp1.forEach(function (v) {
            //----- extract which 'function' on the head of string -----//
            if (v.indexOf('function') === 0) {
                arrTemp2.push(v);
            }
        });
        arrTemp1 = [];
        arrTemp2.forEach(function (v) {
            tempVar1 = v.split('(')[0];
            tempVar2 = tempVar1.split(' ')[1];
            arrTemp1.push(tempVar2);
        });
        return arrTemp1;
    }

}



function encryptTargetJs(localFile, arrBcoreKeyWords) {

    var arrTemp1 = getNoRepeatVarNameArr2();
    var arrNewName = getRandomNameArr(3, arrTemp1.length);
    var countIndex = 0;
    arrTemp1.forEach(function (v) {
        while (getNextValidKeywordIndex(v) > 0) {
            var targetIndex = getNextValidKeywordIndex(v);
            localFile = replaceStrAt(localFile, targetIndex, v, arrNewName[countIndex]);
        }
        countIndex++;
    });
    log(localFile);



    //----- sometime indexOf() finds keyword is not valid -----//
    function isKeywordValid(allStr, keywordIndex, keyword) {
        var ans = true;

        var charL = getKeywordPreviousChar(allStr, keywordIndex);
        var charR = getKeywordNextChar(allStr, keyword, keywordIndex);

        function isCharLAlphabet() {
            return isCharAlphabet(charL);
        }

        function isCharRAlphabet() {
            return isCharAlphabet(charR);
        }

        function isCharLQMark() {
            return (charL === '"');
        }

        function isCharRQMark() {
            return (charR === '"');
        }

        if (isCharLAlphabet() || isCharRAlphabet() || isCharLQMark() || isCharRQMark())
            ans = false;

        return ans;
    }



    function getNextValidKeywordIndex(keyword) {
        //----- if we can not find any valid keyword, return -1 -----//
        var ansIndex = -1;

        var targetIndex = localFile.indexOf(keyword);

        if (isKeywordValid(localFile, targetIndex, keyword)) {
            ansIndex = targetIndex;
        }

        return ansIndex;
    }




    //----- get var-name and not-repeat with bcore's keywords -----//
    function getNoRepeatVarNameArr2() {
        var arrTemp1 = getNoRepeatVarNameArr();
        var arrTemp2 = [];
        arrTemp1.forEach(function (v) {
            if (!isStrInsideArr(arrBcoreKeyWords, v)) {
                arrTemp2.push(v);
            }
        });
        return arrTemp2;
    }



    //----- FINAL: best way to get var-name array without lost -----//
    function getNoRepeatVarNameArr() {
        var arrTemp1 = [];
        var arrTemp2 = [];
        var arrTemp3 = [];
        var arrTemp4 = [];
        var countIndex = 0;
        var tempVar = '';
        arrTemp1 = localFile.split('var ');
        arrTemp1.forEach(function (v) {
            //----- if each string contains '=', means this could be var -----//
            if (v.indexOf('=') > -1) {
                arrTemp2.push(v);
            }
        });
        arrTemp2.forEach(function (v) {
            //----- when first 3 of index contain alphabet char, means could be var -----//
            if (isCharAlphabet(v[0]) && isCharAlphabet(v[1]) && isCharAlphabet(v[2])) {
                arrTemp3.push(v);
            }
        });
        arrTemp3.forEach(function (v) {
            //----- get string before '=' -----//
            arrTemp4.push(v.split(' =')[0]);
        });
        arrTemp4.forEach(function (v) {
            //----- remove ';' and after string -----//
            if (v.indexOf(';') > -1) {
                tempVar = v.split(';')[0];
                delete arrTemp4[countIndex];
                arrTemp4[countIndex] = tempVar;
            }
            countIndex++;
        });
        arrTemp3 = [];
        arrTemp4.forEach(function (v) {
            if (!isStrInsideArr(arrTemp3, v)) {
                arrTemp3.push(v);
            }
        });

        return arrTemp3;
    }
}






/**--------------------------------------------------------------------------------------
 * According to load text file from local having security problems, static js from here
---------------------------------------------------------------------------------------*/
function getBcoreJsText() {
    var ss = 'CgpmdW5jdGlvbiBnZXRPYmoobmFtZSkgewogICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuYW1lKTsKfQoKZnVuY3Rpb24gbG9nKG1zZykgewogICAgY29uc29sZS5sb2cobXNnKTsKfQoKZnVuY3Rpb24gaXNJbnB1dFZhbGlkKHYpIHsKICAgIGlmKCB2IT09dW5kZWZpbmVkICYmIHYhPT1udWxsICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmZ1bmN0aW9uIGlzSW5wdXRCb29sZWFuKHYpIHsKICAgIGlmKCB2IT09dW5kZWZpbmVkICYmIHYhPT1udWxsICYmIHR5cGVvZiB2PT09J2Jvb2xlYW4nICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmZ1bmN0aW9uIGlzSW5wdXRPYmplY3QodikgewogICAgaWYoIHYhPT11bmRlZmluZWQgJiYgdiE9PW51bGwgJiYgdHlwZW9mIHY9PT0nb2JqZWN0JyApIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CgpmdW5jdGlvbiBpc0lucHV0U3RyaW5nKHYpIHsKICAgIGlmKCB2IT09dW5kZWZpbmVkICYmIHYhPT1udWxsICYmIHR5cGVvZiB2PT09J3N0cmluZycgJiYgdi5sZW5ndGghPT0wICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmZ1bmN0aW9uIGlzSW5wdXRGdW5jVHlwZSh2KSB7CiAgICB2YXIgZ2V0VHlwZSA9IHt9OwogICAgaWYoIHYgJiYgZ2V0VHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBGdW5jdGlvbl0nICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmZ1bmN0aW9uIGlzSW5wdXRBcnJheSh2KSB7CiAgICB2YXIgZ2V0VHlwZSA9IHt9OwogICAgaWYoIHYgJiYgZ2V0VHlwZS50b1N0cmluZy5jYWxsKHYpID09PSAnW29iamVjdCBBcnJheV0nICkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCgovLy0tLS0tLS0tLS0tLS0gU1BSSVRFIENMQVNTIC0tLS0tLS0tLS0tLS0tLS0vLwpmdW5jdGlvbiBTcHJpdGUoKSB7Cn0KClNwcml0ZS5wcm90b3R5cGUuaW5pdERpdiA9IGZ1bmN0aW9uKGlkTmFtZSkgewogICAgdGhpcy5vYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRoaXMub2JqLmlkID0gaWROYW1lOwogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAncG9zaXRpb246YWJzb2x1dGU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsnOwogICAgdGhpcy5tYXNrT3ZlcmZsb3codHJ1ZSk7CiAgICB0aGlzLm1ha2VDdXJzb3JOb3JtYWwoKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5vYmopOwogICAgcmV0dXJuIHRoaXMub2JqOwp9OwpTcHJpdGUucHJvdG90eXBlLmNzc1RleHQgPSBmdW5jdGlvbihjc3NTdHIpIHsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gY3NzU3RyOwp9OwpTcHJpdGUucHJvdG90eXBlLmFwcGx5WkluZGV4ID0gZnVuY3Rpb24oekluZGV4KSB7CiAgICAvLy0tLS0tIGFjY29yZGluZyB0byBzYWZhcmkgdjMuMCwgei1pbmRleCByYW5nZTptaW46LTE2Nzc3MjcxLG1heDoxNjc3NzI3MSAtLS0tLS8vCiAgICB2YXIgdiA9ICJ6LWluZGV4OiIrekluZGV4KyI7IjsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gdjsKfTsKU3ByaXRlLnByb3RvdHlwZS5pbml0VGV4dCA9IGZ1bmN0aW9uIChpZE5hbWUsdGV4dFN0cmluZykgewogICAgdGhpcy5vYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRoaXMub2JqLmlkID0gaWROYW1lOwogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAncG9zaXRpb246YWJzb2x1dGU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDt3aGl0ZS1zcGFjZTpub3dyYXA7JzsKICAgIHRoaXMubWFza092ZXJmbG93KHRydWUpOwogICAgdGhpcy5tYWtlQ3Vyc29yTm9ybWFsKCk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMub2JqKTsKICAgIHRoaXMub2JqLmlubmVySFRNTCA9IHRleHRTdHJpbmc7CiAgICByZXR1cm4gdGhpcy5vYmo7Cn07ClNwcml0ZS5wcm90b3R5cGUuaW5pdEJ0biA9IGZ1bmN0aW9uIChidG5UaXRsZVN0cikgewogICAgdGhpcy5vYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIGlmKCBpc0lucHV0U3RyaW5nKGJ0blRpdGxlU3RyKSApCiAgICAgICAgdGhpcy5vYmouaW5uZXJIVE1MID0gYnRuVGl0bGVTdHI7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6bm9uZTtvdXRsaW5lOm5vbmU7b3ZlcmZsb3c6aGlkZGVuO2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7IjsKICAgIHRoaXMubWFrZUN1cnNvck5vcm1hbCgpOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm9iaik7CiAgICByZXR1cm4gdGhpcy5vYmo7Cn07ClNwcml0ZS5wcm90b3R5cGUuaW5pdFRleHRBcmVhID0gZnVuY3Rpb24gKGlkTmFtZSkgewogICAgdGhpcy5vYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpOwogICAgdGhpcy5vYmouaWQgPSBpZE5hbWU7CiAgICB0aGlzLm9iai5zcGVsbGNoZWNrID0gZmFsc2U7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdwb3NpdGlvbjphYnNvbHV0ZTtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O3Jlc2l6ZTpub25lO2JvcmRlcjpub25lO2JveC1zaXppbmc6Ym9yZGVyLWJveDsnOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm9iaik7CiAgICByZXR1cm4gdGhpcy5vYmo7Cn07ClNwcml0ZS5wcm90b3R5cGUudGV4dEFyZWFGb2N1cyA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5vYmouZm9jdXMoKTsKfTsKU3ByaXRlLnByb3RvdHlwZS5ub3RGb2N1cyA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5vYmouYmx1cigpOwp9OwpTcHJpdGUucHJvdG90eXBlLmdldFRleHRBcmVhVGV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm9iai52YWx1ZTsKfTsKU3ByaXRlLnByb3RvdHlwZS50ZXh0QXJlYUVtcHR5ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5vYmoudmFsdWUgPSAnJzsKfTsKU3ByaXRlLnByb3RvdHlwZS5zZXRUZXh0QXJlYVRleHQgPSBmdW5jdGlvbiAodikgewogICAgaWYoaXNJbnB1dFN0cmluZyh2KSkKICAgICAgICB0aGlzLm9iai52YWx1ZSA9IHY7Cn07ClNwcml0ZS5wcm90b3R5cGUudGV4dEFyZWFQYWRkaW5nID0gZnVuY3Rpb24gKHBhZGRpbmdQeFN0cikgewogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAicGFkZGluZzoiK3BhZGRpbmdQeFN0cisicHg7IjsKfTsKU3ByaXRlLnByb3RvdHlwZS5oaWRkZW4gPSBmdW5jdGlvbiAoaXNIaWRkZW4pIHsKICAgIGlmKCBpc0hpZGRlbiApIHsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJ2aXNpYmlsaXR5OmhpZGRlbjsiOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJ2aXNpYmlsaXR5OnZpc2libGU7IjsKICAgIH0KICAgIGlmKCBpc0hpZGRlbj09dW5kZWZpbmVkIHx8IGlzSGlkZGVuPT1udWxsICkgewogICAgICAgIHJldHVybiB0aGlzLm9iai5zdHlsZS52aXNpYmlsaXR5OwogICAgfQp9OwovLy0tLS0tIG1hc2sgYWxsIGNoaWxkIHdoaWNoIG92ZXIgdGhpcyBkaXYgYXJlYSAtLS0tLS8vClNwcml0ZS5wcm90b3R5cGUubWFza092ZXJmbG93ID0gZnVuY3Rpb24oaXNNYXNrKSB7CiAgICBpZiAoIGlzTWFzayApIHsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJvdmVyZmxvdzpoaWRkZW47IjsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAib3ZlcmZsb3c6dmlzaWJsZTsiOwogICAgfQp9OwovLy0tLS0tIGxldCB0aGlzIGRpdiBhcHBlYXIgc2Nyb2xsLWJhciB3aGVuIGNvbnRlbnQgZXh0ZW5kcyBkaXYncyBoZWlnaHQgLS0tLS0vLwpTcHJpdGUucHJvdG90eXBlLnNjcm9sbFZlcnRpY2FsID0gZnVuY3Rpb24odikgewogICAgaWYoIWlzSW5wdXRCb29sZWFuKHYpfHx2PT10cnVlKSB7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAib3ZlcmZsb3cteTphdXRvOyI7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gIm92ZXJmbG93LXk6aGlkZGVuOyI7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuc2Nyb2xsSG9yaXpvbnRhbCA9IGZ1bmN0aW9uKHYpIHsKICAgIGlmKCFpc0lucHV0Qm9vbGVhbih2KXx8dj09dHJ1ZSkgewogICAgICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gIm92ZXJmbG93LXg6YXV0bzsiOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJvdmVyZmxvdy14OmhpZGRlbjsiOwogICAgfQp9OwpTcHJpdGUucHJvdG90eXBlLmlkID0gZnVuY3Rpb24oaWROYW1lKSB7CiAgICBpZiAoaWROYW1lIT09dW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5vYmouaWQgPSBpZE5hbWU7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLm9iai5pZDsKICAgIH0KfTsKU3ByaXRlLnByb3RvdHlwZS5mcmFtZSA9IGZ1bmN0aW9uKGxlZnQsdG9wLHdpZHRoLGhlaWdodCxyaWdodCxib3R0b20pIHsKCiAgICB0aGlzLmxlZnQobGVmdCk7CiAgICB0aGlzLnRvcCh0b3ApOwogICAgdGhpcy53aWR0aCh3aWR0aCk7CiAgICB0aGlzLmhlaWdodChoZWlnaHQpOwogICAgdGhpcy5yaWdodChyaWdodCk7CiAgICB0aGlzLmJvdHRvbShib3R0b20pOwp9OwoKU3ByaXRlLnByb3RvdHlwZS5sZWZ0ID0gZnVuY3Rpb24obGVmdCkgewogICAgaWYoIGxlZnQhPT11bmRlZmluZWQgKSB7CiAgICAgICAgdmFyIHRlbXAgPSAodHlwZW9mIGxlZnQgPT0gInN0cmluZyIpPydsZWZ0OicrbGVmdCsnOyc6J2xlZnQ6JytsZWZ0KydweDsnOwogICAgICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gdGVtcDsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYodHlwZW9mIGxlZnQgPT0gInN0cmluZyIpCiAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLm9iai5zdHlsZS5sZWZ0LnJlcGxhY2UoJyUnLCcnKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5vYmouc3R5bGUubGVmdC5yZXBsYWNlKCdweCcsJycpKTsKICAgIH0KfTsKU3ByaXRlLnByb3RvdHlwZS50b3AgPSBmdW5jdGlvbih0b3ApIHsKICAgIGlmKCB0b3AhPT11bmRlZmluZWQgKSB7CiAgICAgICAgdmFyIHRlbXAgPSAodHlwZW9mIHRvcCA9PSAic3RyaW5nIik/J3RvcDonK3RvcCsnOyc6J3RvcDonK3RvcCsncHg7JzsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9IHRlbXA7CiAgICB9IGVsc2UgewogICAgICAgIGlmKHR5cGVvZiB0b3AgPT0gInN0cmluZyIpCiAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLm9iai5zdHlsZS50b3AucmVwbGFjZSgnJScsJycpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLm9iai5zdHlsZS50b3AucmVwbGFjZSgncHgnLCcnKSk7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuY29udGVudFRvcCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMub2JqLm9mZnNldFRvcDsKfTsKU3ByaXRlLnByb3RvdHlwZS53aWR0aCA9IGZ1bmN0aW9uKHdpZHRoKSB7CiAgICBpZiggd2lkdGghPT11bmRlZmluZWQgKSB7CiAgICAgICAgdmFyIHRlbXAgPSAodHlwZW9mIHdpZHRoID09ICJzdHJpbmciKT8nd2lkdGg6Jyt3aWR0aCsnOyc6J3dpZHRoOicrd2lkdGgrJ3B4Oyc7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSB0ZW1wOwogICAgfSBlbHNlIHsKICAgICAgICBpZih0eXBlb2Ygd2lkdGggPT0gInN0cmluZyIpCiAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLm9iai5zdHlsZS53aWR0aC5yZXBsYWNlKCclJywnJykpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMub2JqLnN0eWxlLndpZHRoLnJlcGxhY2UoJ3B4JywnJykpOwogICAgfQp9OwpTcHJpdGUucHJvdG90eXBlLmNvbnRlbnRXaWR0aCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMub2JqLm9mZnNldFdpZHRoOwp9OwpTcHJpdGUucHJvdG90eXBlLmNvbnRlbnRIZWlnaHQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLm9iai5vZmZzZXRIZWlnaHQ7Cn07ClNwcml0ZS5wcm90b3R5cGUubWluV2lkdGggPSBmdW5jdGlvbih3aWR0aCkgewogICAgaWYoIHdpZHRoIT09dW5kZWZpbmVkICkgewogICAgICAgIHZhciB0ZW1wID0gKHR5cGVvZiB3aWR0aCA9PSAic3RyaW5nIik/J21pbi13aWR0aDonK3dpZHRoKyc7JzonbWluLXdpZHRoOicrd2lkdGgrJ3B4Oyc7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSB0ZW1wOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmoub2Zmc2V0V2lkdGg7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuaGVpZ2h0ID0gZnVuY3Rpb24oaGVpZ2h0KSB7CiAgICBpZiggaGVpZ2h0IT09dW5kZWZpbmVkICkgewogICAgICAgIHZhciB0ZW1wID0gKHR5cGVvZiBoZWlnaHQgPT0gInN0cmluZyIpPydoZWlnaHQ6JytoZWlnaHQrJzsnOidoZWlnaHQ6JytoZWlnaHQrJ3B4Oyc7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSB0ZW1wOwogICAgfSBlbHNlIHsKICAgICAgICBpZih0eXBlb2YgaGVpZ2h0ID09ICJzdHJpbmciKQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5vYmouc3R5bGUuaGVpZ2h0LnJlcGxhY2UoJyUnLCcnKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5vYmouc3R5bGUuaGVpZ2h0LnJlcGxhY2UoJ3B4JywnJykpOwogICAgfQp9OwpTcHJpdGUucHJvdG90eXBlLnJpZ2h0ID0gZnVuY3Rpb24ocmlnaHQpIHsKICAgIGlmKCByaWdodCE9PXVuZGVmaW5lZCApIHsKICAgICAgICB2YXIgdGVtcCA9ICh0eXBlb2YgcmlnaHQgPT0gInN0cmluZyIpPydyaWdodDonK3JpZ2h0Kyc7JzoncmlnaHQ6JytyaWdodCsncHg7JzsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9IHRlbXA7CiAgICB9IGVsc2UgewogICAgICAgIGlmKHR5cGVvZiByaWdodCA9PSAic3RyaW5nIikKICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMub2JqLnN0eWxlLnJpZ2h0LnJlcGxhY2UoJyUnLCcnKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5vYmouc3R5bGUucmlnaHQucmVwbGFjZSgncHgnLCcnKSk7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuYm90dG9tID0gZnVuY3Rpb24oYm90dG9tKSB7CiAgICBpZiggYm90dG9tIT09dW5kZWZpbmVkICkgewogICAgICAgIHZhciB0ZW1wID0gKHR5cGVvZiBib3R0b20gPT0gInN0cmluZyIpPydib3R0b206Jytib3R0b20rJzsnOidib3R0b206Jytib3R0b20rJ3B4Oyc7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSB0ZW1wOwogICAgfSBlbHNlIHsKICAgICAgICBpZih0eXBlb2YgYm90dG9tID09ICJzdHJpbmciKQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5vYmouc3R5bGUuYm90dG9tLnJlcGxhY2UoJyUnLCcnKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy5vYmouc3R5bGUuYm90dG9tLnJlcGxhY2UoJ3B4JywnJykpOwogICAgfQp9OwoKU3ByaXRlLnByb3RvdHlwZS5tYXJnaW5GcmFtZSA9IGZ1bmN0aW9uKGxlZnQscmlnaHQsdG9wLGJvdHRvbSkgewoKICAgIHZhciB0ZW1wOwoKICAgIGlmKCBsZWZ0IT09dW5kZWZpbmVkICkgewogICAgICAgIHRlbXAgPSAodHlwZW9mIGxlZnQgPT0gInN0cmluZyIpPydtYXJnaW4tbGVmdDonK2xlZnQrJzsnOidtYXJnaW4tbGVmdDonK2xlZnQrJ3B4Oyc7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSB0ZW1wOwogICAgfQogICAgaWYoIHRvcCE9PXVuZGVmaW5lZCApIHsKICAgICAgICB0ZW1wID0gKHR5cGVvZiB0b3AgPT0gInN0cmluZyIpPydtYXJnaW4tdG9wOicrdG9wKyc7JzonbWFyZ2luLXRvcDonK3RvcCsncHg7JzsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9IHRlbXA7CiAgICB9CiAgICBpZiggcmlnaHQhPT11bmRlZmluZWQgKSB7CiAgICAgICAgdGVtcCA9ICh0eXBlb2YgcmlnaHQgPT0gInN0cmluZyIpPydtYXJnaW4tcmlnaHQ6JytyaWdodCsnOyc6J21hcmdpbi1yaWdodDonK3JpZ2h0KydweDsnOwogICAgICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gdGVtcDsKICAgIH0KICAgIGlmKCBib3R0b20hPT11bmRlZmluZWQgKSB7CiAgICAgICAgdGVtcCA9ICh0eXBlb2YgYm90dG9tID09ICJzdHJpbmciKT8nbWFyZ2luLWJvdHRvbTonK2JvdHRvbSsnOyc6J21hcmdpbi1ib3R0b206Jytib3R0b20rJ3B4Oyc7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSB0ZW1wOwogICAgfQp9OwovLy0tLS0tIGRpdiByb3RhdGUsZXg6c3Mucm90YXRlKDkwKTsgLS0tLS0vLwpTcHJpdGUucHJvdG90eXBlLnJvdGF0ZSA9IGZ1bmN0aW9uKHYpIHsKICAgIGlmKCBpc0lucHV0VmFsaWQodikgKSB7CiAgICAgICAgdmFyIHRlbXAgPSAndHJhbnNmb3JtOnJvdGF0ZSgnK3YrJ2RlZyk7JzsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9IHRlbXA7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuY29sb3IgPSBmdW5jdGlvbihyLGcsYikgewogICAgdmFyIGMgPSAncmdiKCcrcisnLCcrZysnLCcrYisnKTsnOwogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAnYmFja2dyb3VuZDonICsgYyArICc7JzsKICAgIHJldHVybiB0aGlzLm9iai5zdHlsZS5iYWNrZ3JvdW5kOwp9OwpTcHJpdGUucHJvdG90eXBlLmNvbG9ySGV4ID0gZnVuY3Rpb24oaGV4U3RyaW5nKSB7CiAgICB2YXIgYyA9ICcjJytoZXhTdHJpbmc7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdiYWNrZ3JvdW5kOicgKyBjICsgJzsnOwogICAgcmV0dXJuIHRoaXMub2JqLnN0eWxlLmJhY2tncm91bmQ7Cn07ClNwcml0ZS5wcm90b3R5cGUuYmFja2dyb3VuZEFscGhhID0gZnVuY3Rpb24odikgewogICAgdmFyIHJlZ0V4ID0gL1swLTldKy9nOwogICAgdmFyIGFyciA9ICh0aGlzLm9iai5zdHlsZS5iYWNrZ3JvdW5kKS5tYXRjaChyZWdFeCk7CiAgICBpZiggIWlzSW5wdXRWYWxpZCh2KSApCiAgICAgICAgdiA9ICcxJzsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gJ2JhY2tncm91bmQ6cmdiYSgnK2FyclswXSsnLCcrYXJyWzFdKycsJythcnJbMl0rJywnK3YrJyk7JzsKfTsKU3ByaXRlLnByb3RvdHlwZS5ib3JkZXIgPSBmdW5jdGlvbih3aWR0aFB4LGNvbG9ySGV4U3RyLGlzSW5uZXIpIHsKICAgIHZhciBjID0gd2lkdGhQeCsicHgiKyIgIisic29saWQiKyIgIisiIyIrY29sb3JIZXhTdHI7CiAgICBpZiggaXNJbnB1dEJvb2xlYW4oaXNJbm5lcikmJmlzSW5uZXIgKQogICAgICAgIGMgKz0gJztib3gtc2l6aW5nOmJvcmRlci1ib3gnOwogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAnYm9yZGVyOicgKyBjICsgJzsnOwp9OwpTcHJpdGUucHJvdG90eXBlLmJvcmRlckNvbG9yID0gZnVuY3Rpb24oY29sb3JIZXhTdHIpIHsKICAgIHZhciBjID0gIiMiK2NvbG9ySGV4U3RyOwogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAnYm9yZGVyLWNvbG9yOicgKyBjICsgJzsnOwp9OwpTcHJpdGUucHJvdG90eXBlLmJvcmRlcldpZHRoID0gZnVuY3Rpb24od2lkdGhQeCkgewogICAgdmFyIGMgPSB3aWR0aFB4KyJweCI7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdib3JkZXItd2lkdGg6JyArIGMgKyAnOyc7Cn07ClNwcml0ZS5wcm90b3R5cGUuY29ybmVyUmFkaXVzID0gZnVuY3Rpb24ocmFkaXVzUHgpIHsKICAgIHZhciBjID0gcmFkaXVzUHgrInB4IjsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gImJvcmRlci1yYWRpdXM6IiArIGMgKyAiOyI7Cn07ClNwcml0ZS5wcm90b3R5cGUuc2hhZG93ID0gZnVuY3Rpb24oaG9yaXpvbnRhbFB4LHZlcnRpY2FsUHgsYmx1clB4LGFscGhhKSB7CiAgICB2YXIgYyA9ICJyZ2JhKDAsMCwwLCIrYWxwaGErIikiOwogICAgdmFyIGMxID0gaG9yaXpvbnRhbFB4KyJweCIrIiAiK3ZlcnRpY2FsUHgrInB4IisiICIrYmx1clB4KyJweCIrIiAiK2M7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJib3gtc2hhZG93OiIrYzErIjsiOwp9OwpTcHJpdGUucHJvdG90eXBlLmFscGhhID0gZnVuY3Rpb24oYWxwaGEpIHsKICAgIGlmKCBpc0lucHV0VmFsaWQoYWxwaGEpICkKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdvcGFjaXR5OicgKyBhbHBoYSArICc7JzsKICAgIGVsc2UKICAgICAgICByZXR1cm4gdGhpcy5vYmouc3R5bGUub3BhY2l0eTsKfTsKU3ByaXRlLnByb3RvdHlwZS5hZGRDaGlsZCA9IGZ1bmN0aW9uKHR0dCkgewogICAgdGhpcy5vYmouYXBwZW5kQ2hpbGQodHR0Lm9iaik7Cn07ClNwcml0ZS5wcm90b3R5cGUucmVtb3ZlQWxsQ2hpbGQgPSBmdW5jdGlvbigpIHsKICAgIHdoaWxlKCB0aGlzLm9iai5oYXNDaGlsZE5vZGVzKCkgKSB7CiAgICAgICAgdGhpcy5vYmoucmVtb3ZlQ2hpbGQodGhpcy5vYmoubGFzdENoaWxkKTsKICAgIH0KfTsKU3ByaXRlLnByb3RvdHlwZS5yZW1vdmVGcm9tUGFyZW50ID0gZnVuY3Rpb24oKSB7CgogICAgaWYoIHRoaXMub2JqLnBhcmVudEVsZW1lbnQgKSB7CiAgICAgICAgKHRoaXMub2JqLnBhcmVudEVsZW1lbnQpLnJlbW92ZUNoaWxkKHRoaXMub2JqKTsKICAgIH0KfTsKU3ByaXRlLnByb3RvdHlwZS51c2VySW50ZXJhY3Rpb25FbmFibGVkID0gZnVuY3Rpb24oaXNFbmFibGVkKSB7CiAgICBpZiggaXNFbmFibGVkICkgewogICAgICAgIHRoaXMub2JqLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAiYXV0byI7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMub2JqLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAibm9uZSI7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuYWRkTW91c2VPdmVyID0gZnVuY3Rpb24oZnVuYykgewogICAgdGhpcy5vYmouYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdmVyIixmdW5jLGZhbHNlKTsKfTsKU3ByaXRlLnByb3RvdHlwZS5hZGRNb3VzZU91dCA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHRoaXMub2JqLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0IixmdW5jLGZhbHNlKTsKfTsKU3ByaXRlLnByb3RvdHlwZS5hZGRNb3VzZURvd24gPSBmdW5jdGlvbihmdW5jKSB7CiAgICB0aGlzLm9iai5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jLCBmYWxzZSk7Cn07ClNwcml0ZS5wcm90b3R5cGUuYWRkTW91c2VVcCA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHRoaXMub2JqLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jLCBmYWxzZSk7Cn07ClNwcml0ZS5wcm90b3R5cGUuYWRkTW91c2VNb3ZlID0gZnVuY3Rpb24oZnVuYykgewogICAgdGhpcy5vYmouYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuYywgdHJ1ZSk7Cn07ClNwcml0ZS5wcm90b3R5cGUuYWRkTW91c2VDbGljayA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHRoaXMub2JqLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxmdW5jLGZhbHNlKTsKfTsKU3ByaXRlLnByb3RvdHlwZS5hZGRNb3VzZURvdWJsZUNsaWNrID0gZnVuY3Rpb24oZnVuYykgewogICAgdGhpcy5vYmouYWRkRXZlbnRMaXN0ZW5lcignZGJsY2xpY2snLGZ1bmMsZmFsc2UpOwp9OwovKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqIFF1aWNrIGFkZCBtb3VzZS1ldmVudCBmb3IgY2hhbmdpbmcgY29sb3IgYW5kIGZhZGUtYW5pLCBqdXN0IGxpa2UgYnV0dG9uCiAqIEV4OiB2MS5hZGRNb3VzZUNvbG9yRXZlbnQoe2NvbG9yTm9ybWFsOic5OTAwMDAnLGNvbG9yT3ZlcjonRkYwMDAwJyxjb2xvckRvd246J0ZGRjAwMCcsZmFkZU91dFNwZWVkOi4zfSk7CiAqIGNvbG9yTm9ybWFsOiBpcyBtdXN0IGhhdmUgdmFyLCBkZWZpbmVkIGNvbG9yIGluIG5vcm1hbC1zdGF0ZQogKiBjb2xvck92ZXI6ICAgd2hlbiB0aGlzIHZhciBleGlzdCwgbWVhbnMgd2UgaGF2ZSBtb3VzZS1vdmVyIGFuZCBtb3VzZS1vdXQgc3RhdGUKICogY29sb3JEb3duOiAgIHdoZW4gZXhpc3QsIG1lYW5zIHdlIGhhdmUgbW91c2UtZG93biBhbmQgbW91c2UtdXAgc3RhdGUKICogZmFkZU91dFNwZWVkOndoZW4gZXhpc3QsIG1lYW5zIHdlIGhhdmUgZmFkZS1vdXQgYW5pbWF0aW9uCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogUC5TLiBtb3VzZS1kb3duIGFuZCBtb3VzZS11cCBtYXkgaGF2ZSBkZWxheSBpbiBicm93c2VyJ3MgZGV2ZWxvcGVyLW1vZGUKIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwpTcHJpdGUucHJvdG90eXBlLmFkZE1vdXNlQ29sb3JFdmVudCA9IGZ1bmN0aW9uKHYpIHsKICAgIHZhciB0d2VlbiA9IG51bGw7CiAgICB2LnNwID0gdGhpczsKICAgIGlmKGlzSW5wdXRWYWxpZCh2KSkgewogICAgICAgIGlmKGlzSW5wdXRTdHJpbmcodi5jb2xvck92ZXIpKSB7CiAgICAgICAgICAgIHRoaXMuYWRkTW91c2VPdmVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYodHdlZW4pCiAgICAgICAgICAgICAgICAgICAgdHdlZW4ua2lsbCgpOwogICAgICAgICAgICAgICAgdi5zcC5jb2xvckhleCh2LmNvbG9yT3Zlcik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmFkZE1vdXNlT3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYoaXNJbnB1dFZhbGlkKHYuZmFkZU91dFNwZWVkKSkgewogICAgICAgICAgICAgICAgICAgIHR3ZWVuID0gdi5zcC5hbmlCeUNvbG9yKHYuZmFkZU91dFNwZWVkLHYuY29sb3JOb3JtYWwsZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2LnNwLmNvbG9ySGV4KHYuY29sb3JOb3JtYWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYoaXNJbnB1dFN0cmluZyh2LmNvbG9yRG93bikpIHsKICAgICAgICAgICAgdGhpcy5hZGRNb3VzZURvd24oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZih0d2VlbikKICAgICAgICAgICAgICAgICAgICB0d2Vlbi5raWxsKCk7CiAgICAgICAgICAgICAgICB2LnNwLmNvbG9ySGV4KHYuY29sb3JEb3duKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuYWRkTW91c2VVcChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmKHYuY29sb3JPdmVyKQogICAgICAgICAgICAgICAgICAgIHYuc3AuY29sb3JIZXgodi5jb2xvck92ZXIpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHYuc3AuY29sb3JIZXgodi5jb2xvck5vcm1hbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KfTsKU3ByaXRlLnByb3RvdHlwZS5hbmlfeCA9IGZ1bmN0aW9uKGR1cmF0aW9uLGRpcyxpc0JvdW5jZSxmdW5jVXBkYXRlLGZ1bmNEb25lKSB7CiAgICB2YXIgYWFhID0gZGlzICsgJ3B4JzsKICAgIHZhciBiYmIgPSBpc0JvdW5jZSA/IEJvdW5jZS5lYXNlT3V0IDogbnVsbDsKICAgIHJldHVybiBUd2VlbkxpdGUudG8odGhpcy5vYmosZHVyYXRpb24se2xlZnQ6YWFhLGVhc2U6YmJiLG9uVXBkYXRlOmZ1bmNVcGRhdGUsb25Db21wbGV0ZTpmdW5jRG9uZX0pOwp9OwpTcHJpdGUucHJvdG90eXBlLmFuaV95ID0gZnVuY3Rpb24oZHVyYXRpb24sZGlzLGlzQm91bmNlLGZ1bmNVcGRhdGUsZnVuY0RvbmUpIHsKICAgIHZhciBhYWEgPSBkaXMgKyAncHgnOwogICAgdmFyIGJiYiA9IGlzQm91bmNlID8gQm91bmNlLmVhc2VPdXQgOiBudWxsOwogICAgcmV0dXJuIFR3ZWVuTGl0ZS50byh0aGlzLm9iaixkdXJhdGlvbix7dG9wOmFhYSxlYXNlOmJiYixvblVwZGF0ZTpmdW5jVXBkYXRlLG9uQ29tcGxldGU6ZnVuY0RvbmV9KTsKfTsKU3ByaXRlLnByb3RvdHlwZS5hbmlCeUNvbG9yID0gZnVuY3Rpb24gKGR1cmF0aW9uLGhleFN0cmluZyxpc0JvdW5jZSkgewogICAgdmFyIGJiYiA9IGlzQm91bmNlID8gQm91bmNlLmVhc2VPdXQgOiBudWxsOwogICAgdmFyIGNjYyA9ICIjIitoZXhTdHJpbmc7CiAgICByZXR1cm4gVHdlZW5MaXRlLnRvKHRoaXMub2JqLGR1cmF0aW9uLHtjc3M6e2JhY2tncm91bmRDb2xvcjpjY2N9LGVhc2U6YmJifSk7Cn07Ci8vLS0tLS0gY3NzQmxvY2sgZXhhbXBsZToge2xlZnQ6MCx0b3A6MCx3aWR0aDozMCxoZWlnaHQ6MzB9IC0tLS0tLy8KU3ByaXRlLnByb3RvdHlwZS5hbmlCeUNTUyA9IGZ1bmN0aW9uIChkdXJhdGlvbixjc3NCbG9jayxpc0JvdW5jZSxvbkRvbmVGdW5jKSB7CiAgICB2YXIgYmJiID0gaXNCb3VuY2UgPyBCb3VuY2UuZWFzZU91dCA6IG51bGw7CiAgICByZXR1cm4gVHdlZW5MaXRlLnRvKHRoaXMub2JqLGR1cmF0aW9uLHtjc3M6Y3NzQmxvY2ssZWFzZTpiYmIsb25Db21wbGV0ZTpvbkRvbmVGdW5jfSk7Cn07ClNwcml0ZS5wcm90b3R5cGUuYW5pQnlBbHBoYSA9IGZ1bmN0aW9uIChkdXJhdGlvbixhbHBoYVZhcixvbkNvbXBsZXRlRnVuYykgewogICAgcmV0dXJuIFR3ZWVuTGl0ZS50byh0aGlzLm9iaixkdXJhdGlvbix7YWxwaGE6YWxwaGFWYXIsIG9uQ29tcGxldGU6b25Db21wbGV0ZUZ1bmN9KTsKfTsKCgoKLy8tLS0tLS0tLS0tLS0tIFNQUklURSBURVhUIC0tLS0tLS0tLS0tLS0tLS0vLwpTcHJpdGUucHJvdG90eXBlLmFwcGx5VGV4dCA9IGZ1bmN0aW9uICh0ZXh0U3RyaW5nKSB7CiAgICB0aGlzLm9iai5pbm5lckhUTUwgPSB0ZXh0U3RyaW5nOwogICAgcmV0dXJuIHRoaXMub2JqLmlubmVySFRNTDsKfTsKU3ByaXRlLnByb3RvdHlwZS50ZXh0Q29sb3IgPSBmdW5jdGlvbiAoaGV4U3RyaW5nKSB7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJjb2xvcjojIitoZXhTdHJpbmcrIjsiOwogICAgcmV0dXJuIHRoaXMub2JqLnN0eWxlLmNvbG9yOwp9OwpTcHJpdGUucHJvdG90eXBlLnRleHRGb250ID0gZnVuY3Rpb24gKHYpIHsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gJ2ZvbnQtZmFtaWx5OicrIiciK3YrIiciKyc7JzsKfTsKU3ByaXRlLnByb3RvdHlwZS50ZXh0U2l6ZSA9IGZ1bmN0aW9uIChweFN0cmluZykgewogICAgaWYoaXNJbnB1dFZhbGlkKHB4U3RyaW5nKSkKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJmb250LXNpemU6IitweFN0cmluZysicHgiKyI7IjsKICAgIHJldHVybiB0aGlzLm9iai5zdHlsZS5mb250U2l6ZTsKfTsKU3ByaXRlLnByb3RvdHlwZS50ZXh0V2VpZ2h0ID0gZnVuY3Rpb24gKGxldmVsMXRvOSkgewogICAgbGV2ZWwxdG85ICo9IDEwMDsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gImZvbnQtd2VpZ2h0OiIrbGV2ZWwxdG85KyI7IjsKfTsKU3ByaXRlLnByb3RvdHlwZS5hbGlnbkNlbnRlciA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gImxlZnQ6NTAlO3RvcDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwLjUlKXRyYW5zbGF0ZVkoLTUwLjUlKTsiOwp9OwpTcHJpdGUucHJvdG90eXBlLmFsaWduQ2VudGVyVmVydGljYWwgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJ0b3A6NTAlO3RyYW5zZm9ybTp0cmFuc2xhdGVZKC01MC41JSk7IjsKfTsKU3ByaXRlLnByb3RvdHlwZS5hbGlnbkNlbnRlckhvcml6b250YWwgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICJsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAuNSUpOyI7Cn07ClNwcml0ZS5wcm90b3R5cGUudGV4dEFsaWduQ2VudGVyID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAidGV4dC1hbGlnbjpjZW50ZXI7dmVydGljYWwtYWxpZ246bWlkZGxlOyIrJ2xpbmUtaGVpZ2h0OicrdGhpcy5vYmoub2Zmc2V0SGVpZ2h0KydweDsnOwp9OwpTcHJpdGUucHJvdG90eXBlLnRleHRBbGlnbkNlbnRlclZlcnRpY2FsID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAidmVydGljYWwtYWxpZ246bWlkZGxlOyIrJ2xpbmUtaGVpZ2h0OicrdGhpcy5vYmoub2Zmc2V0SGVpZ2h0KydweDsnOwp9OwpTcHJpdGUucHJvdG90eXBlLnRleHRBbGlnblZlcnRpY2FsQnlMaW5lSGVpZ2h0ID0gZnVuY3Rpb24oaW50SGVpZ2h0KSB7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdsaW5lLWhlaWdodDonK2ludEhlaWdodCsncHg7JzsKfTsKU3ByaXRlLnByb3RvdHlwZS50ZXh0QWxpZ25DZW50ZXJIb3Jpem9udGFsID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICd0ZXh0LWFsaWduOmNlbnRlcjsnOwp9OwovLy0tLS0tIG1ha2UgdGFyZ2V0IHVuLXNlbGVjdGVkLCB1bi1zZWxlY3RhYmxlIC0tLS0tLy8KU3ByaXRlLnByb3RvdHlwZS5tYWtlQ3Vyc29yTm9ybWFsID0gZnVuY3Rpb24odikgewogICAgaWYoICFpc0lucHV0VmFsaWQodikgfHwgaXNJbnB1dEJvb2xlYW4odikmJnY9PXRydWUgKSB7CiAgICAgICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAiY3Vyc29yOmRlZmF1bHQ7dXNlci1zZWxlY3Q6bm9uZTstbXMtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LWtodG1sLXVzZXItc2VsZWN0Om5vbmU7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy13ZWJraXQtdG91Y2gtY2FsbG91dDpub25lOyI7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gImN1cnNvcjpkZWZhdWx0O3VzZXItc2VsZWN0OnRleHQ7LW1zLXVzZXItc2VsZWN0OnRleHQ7LW1vei11c2VyLXNlbGVjdDp0ZXh0Oy1raHRtbC11c2VyLXNlbGVjdDp0ZXh0Oy13ZWJraXQtdXNlci1zZWxlY3Q6dGV4dDstd2Via2l0LXRvdWNoLWNhbGxvdXQ6dGV4dDsiOwogICAgfQp9OwoKCi8vLS0tLS0tLS0tLS0tLSBTUFJJVEUgSU1BR0UgLS0tLS0tLS0tLS0tLS0tLS8vClNwcml0ZS5wcm90b3R5cGUuaW5pdEltYWdlID0gZnVuY3Rpb24gKGlkTmFtZSxpbWdVcmxTdHJpbmcpIHsKCiAgICB0aGlzLm9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgaWYoIGlzSW5wdXRTdHJpbmcoaWROYW1lKSApIHsKICAgICAgICB0aGlzLm9iai5pZCA9IGlkTmFtZTsKICAgIH0KICAgIGlmKCBpc0lucHV0U3RyaW5nKGltZ1VybFN0cmluZykgKSB7CiAgICAgICAgdGhpcy5vYmouc3JjID0gaW1nVXJsU3RyaW5nOwogICAgICAgIHRoaXMub2JqLnN0eWxlLmNzc1RleHQgKz0gJ3Bvc2l0aW9uOmFic29sdXRlO2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnQ7JzsKICAgICAgICB0aGlzLm1hc2tPdmVyZmxvdyh0cnVlKTsKICAgICAgICB0aGlzLm1ha2VDdXJzb3JOb3JtYWwoKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMub2JqKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5vYmo7Cn07ClNwcml0ZS5wcm90b3R5cGUuaW5pdEltYWdlQnlTVkcgPSBmdW5jdGlvbiggaWROYW1lLHN2Z0Jhc2U2NFN0cmluZyApIHsKCiAgICB0aGlzLm9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgaWYoIGlzSW5wdXRWYWxpZChpZE5hbWUpICkgewogICAgICAgIHRoaXMub2JqLmlkID0gaWROYW1lOwogICAgfQogICAgaWYoIGlzSW5wdXRTdHJpbmcoc3ZnQmFzZTY0U3RyaW5nKSApIHsKICAgICAgICB0aGlzLm9iai5zcmMgPSAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnK3N2Z0Jhc2U2NFN0cmluZzsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdwb3NpdGlvbjphYnNvbHV0ZTtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50Oyc7CiAgICAgICAgdGhpcy5tYXNrT3ZlcmZsb3codHJ1ZSk7CiAgICAgICAgdGhpcy5tYWtlQ3Vyc29yTm9ybWFsKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm9iaik7CiAgICB9Cn07ClNwcml0ZS5wcm90b3R5cGUuc3ZnQ29sb3JCeUhleCA9IGZ1bmN0aW9uKCBoZXhTdHIgKSB7CgogICAgdmFyIGFyciA9ICh0aGlzLm9iai5zcmMpLnNwbGl0KCcsJyk7CgogICAgdmFyIGluZGV4U3RhcnQgPSAoYXRvYihhcnJbMV0pKS5pbmRleE9mKCdmaWxsPSIjJyk7CiAgICB0aGlzLm9iai5zcmMgPSBhcnJbMF0rJywnK2J0b2EoKGF0b2IoYXJyWzFdKSkucmVwbGFjZSggKGF0b2IoYXJyWzFdKSkuc3Vic3RyaW5nKGluZGV4U3RhcnQsaW5kZXhTdGFydCsxMyksJ2ZpbGw9IiMnK2hleFN0cikpOwoKfTsKU3ByaXRlLnByb3RvdHlwZS5nZXRJbWFnZVdpZHRoID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMub2JqLm5hdHVyYWxXaWR0aDsKfTsKU3ByaXRlLnByb3RvdHlwZS5nZXRJbWFnZUhlaWdodCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm9iai5uYXR1cmFsSGVpZ2h0Owp9OwpTcHJpdGUucHJvdG90eXBlLmZpdEltYWdlT3JpZ2luU2l6ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB3ID0gdGhpcy5nZXRJbWFnZVdpZHRoKCk7CiAgICB2YXIgaCA9IHRoaXMuZ2V0SW1hZ2VIZWlnaHQoKTsKICAgIHRoaXMud2lkdGgodyk7CiAgICB0aGlzLmhlaWdodChoKTsKfTsKU3ByaXRlLnByb3RvdHlwZS51cGRhdGVJbWFnZSA9IGZ1bmN0aW9uIChpbWdVcmxTdHJpbmcpIHsKICAgIHZhciBpbWcgPSB0aGlzLm9iajsKICAgIGltZy5zcmMgPSBpbWdVcmxTdHJpbmc7Cn07CgoKCgoKCi8vLS0tLS0tLS0tLS0tLSBTUFJJVEUgSU5QVVQgVEVYVCAtLS0tLS0tLS0tLS0tLS0tLy8KU3ByaXRlLnByb3RvdHlwZS5pbml0SW5wdXRUZXh0ID0gZnVuY3Rpb24gKGlkTmFtZSkgewoKICAgIHRoaXMub2JqID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgIGlmKCBpc0lucHV0U3RyaW5nKGlkTmFtZSkgKSB7CiAgICAgICAgdGhpcy5vYmouaWQgPSBpZE5hbWU7CiAgICB9CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdwb3NpdGlvbjphYnNvbHV0ZTtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50O2JvcmRlcjpub25lO291dGxpbmU6bm9uZTsnOwogICAgdGhpcy5tYWtlQ3Vyc29yTm9ybWFsKCk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMub2JqKTsKCiAgICByZXR1cm4gdGhpcy5vYmo7Cn07Ci8vLS0tLS0gKHByZXNzIGVudGVyKSAgIGUua2V5Y29kZT09MTMgLS0tLS0vLwpTcHJpdGUucHJvdG90eXBlLmFkZEtleWJvYXJkVXAgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB0aGlzLm9iai5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmMsIGZhbHNlKTsKfTsKU3ByaXRlLnByb3RvdHlwZS5nZXRJbnB1dFRleHQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLm9iai52YWx1ZTsKfTsKU3ByaXRlLnByb3RvdHlwZS5zZXRJbnB1dFRleHQgPSBmdW5jdGlvbih2KSB7CiAgICB0aGlzLm9iai52YWx1ZSA9IHY7Cn07CgoKLy8tLS0tLS0tLS0tLS0tIFNQUklURSBUUklBTkdMRSBTSEFQRSAtLS0tLS0tLS0tLS0tLS0tLy8KU3ByaXRlLnByb3RvdHlwZS5pbml0VHJpYW5nbGUgPSBmdW5jdGlvbihpZCx3LGgsaGV4KXsKCiAgICB0aGlzLm9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgaWYoIGlzSW5wdXRTdHJpbmcoaWQpICkKICAgICAgICB0aGlzLm9iai5pZCA9IGlkOwogICAgdmFyIHYxID0gJ2JvcmRlci13aWR0aDowICcrdy8yKydweCAnK2grJ3B4ICcrdy8yKydweDsnOwogICAgdmFyIHYyID0gJ2JvcmRlci1jb2xvcjp0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAnKycjJytoZXgrJyB0cmFuc3BhcmVudCc7CiAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDowO2hlaWdodDowO2JvcmRlci1zdHlsZTpzb2xpZDsnK3YxK3YyOwogICAgdGhpcy5tYXNrT3ZlcmZsb3codHJ1ZSk7CiAgICB0aGlzLm1ha2VDdXJzb3JOb3JtYWwoKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5vYmopOwoKICAgIHJldHVybiB0aGlzLm9iajsKfTsKClNwcml0ZS5wcm90b3R5cGUudHJpYW5nbGVDb2xvciA9IGZ1bmN0aW9uKGhleCkgewogICAgaWYoIGlzSW5wdXRTdHJpbmcoaGV4KSApIHsKICAgICAgICB0aGlzLm9iai5zdHlsZS5jc3NUZXh0ICs9ICdib3JkZXItY29sb3I6dHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgJysnIycraGV4KycgdHJhbnNwYXJlbnQnOwogICAgfQp9OwoKCi8vLS0tLS0tLS0tLS0tLSBTUFJJVEUgSFRUUCBHRVQgLS0tLS0tLS0tLS0tLS0tLS8vCi8vIHYxOnJlcXVlc3QgdXJsLGV4OmxvZ2luLnBocCB2MjpwYXJhbWV0ZXJzIGZvbGxvd3MsZXg6bG9naW4ucGhwP25hbWU9eHgmcGFzcz15eQovLyBleDogaHR0cEdldCgnc3MucGhwJyxbJz90eXBlPTMzJywnJm5hbWU9dXUnXSxmdW5jLi4uClNwcml0ZS5wcm90b3R5cGUuaHR0cEdldCA9IGZ1bmN0aW9uKHVybCxhcnIsZnVuYykgewogICAgdmFyIHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIHhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSA0ICYmIHRoaXMuc3RhdHVzID09IDIwMCkgewogICAgICAgICAgICBmdW5jKHRoaXMucmVzcG9uc2VUZXh0KTsKICAgICAgICB9CiAgICB9OwogICAgdmFyIHBhcmFtICA9ICcnOwogICAgaWYoaXNJbnB1dEFycmF5KGFycikpIHsKICAgICAgICBhcnIuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgIHBhcmFtICs9IGl0ZW07CiAgICAgICAgfSk7CiAgICB9CiAgICB4bWxodHRwLm9wZW4oIkdFVCIsIHVybCtwYXJhbSwgdHJ1ZSk7CiAgICB4bWxodHRwLnNlbmQoKTsKCiAgICAvLy0tLS0tIHlvdSBjYW4gc3RvcCB0aGlzIHJlcXVlc3QgaWYgbmVjZXNzYXJ5LCBleDp4bWxodHRwLmFib3J0KCkKICAgIHJldHVybiB4bWxodHRwOwp9OwoKCi8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogUFJPQkxFTVMoMjAxN0phbik6CiAqIDEpIGZvbnQtZmFjZSBvbmx5IHN1cHBvcnQgaWUxMCBhbmQgYWJvdmUsIGllOSBub3Qgc3VwcG9ydGVkCiAqIDIpIGZvbnQgZm9yIGNodCBzaXplIGlzIGxhcmdlLCAxLjJtYiBpcyBhIG5vcm1hbCBzaXplLCBzbG93IGRvd24gd2ViLXBhZ2UgbG9hZGluZyBzcGVlZAogKiAzKSBmb250IG1heSBzdG9yZSBvbiBzZXJ2ZXIsIGRpZmYgc2VydmVyIG1heSBjYXVzZSBzbG93IGxvYWRpbmcgc3BlZWQKICogNCkgYmVzdCBmb250IHNlcnZlciBmb3Igbm93IGlzIGdvb2dsZSwgYmVzdCBsb2FkaW5nIHNwZWVkCiAqIDUpIGZpbmFsIGZvbnQtZmFjZSBjc3MgRXg6CiAqIEBmb250LWZhY2UgewogICAgICAgIGZvbnQtZmFtaWx5OiAnTm90byBTYW5zIFRDJzsKICAgICAgICBmb250LXN0eWxlOiBub3JtYWw7CiAgICAgICAgZm9udC13ZWlnaHQ6IDkwMDsKICAgICAgICBzcmM6IHVybCgvL2ZvbnRzLmdzdGF0aWMuY29tL2VhL25vdG9zYW5zdGMvdjEvTm90b1NhbnNUQy1MaWdodC53b2ZmMikgZm9ybWF0KCd3b2ZmMicpLAogICAgICAgIHVybCgvL2ZvbnRzLmdzdGF0aWMuY29tL2VhL25vdG9zYW5zdGMvdjEvTm90b1NhbnNUQy1MaWdodC53b2ZmKSBmb3JtYXQoJ3dvZmYnKSwKICAgICAgICB1cmwoLy9mb250cy5nc3RhdGljLmNvbS9lYS9ub3Rvc2Fuc3RjL3YxL05vdG9TYW5zVEMtTGlnaHQub3RmKSBmb3JtYXQoJ29wZW50eXBlJyk7CiAgICB9CiAqIDYpIHRoaXMgZnVuYyBuZWVkIHRvIGJlIGVkaXQgaW4gZnV0dXJlLCBtYWtlIGNzcyBmb3JtYXQganVzdCBsaWtlIGFib3ZlCiAqIDcpIGVhY2ggZm9udCBuZWVkIHRvIGNvbnZlcnQgMyBkaWZmIHR5cGVzKHdvZmYsd29mZjIsb3BlbnR5cGUpLCBmb3IgZGlmZiBwbGF0Zm9ybQogKiA3KSBSZXN1bHQ6YmVzdCB3YXkgaXMgdXNpbmcgbG9jYWwtY29tcHV0ZXIncyBmb250LCBubyBleHRyYSBmb250LWxvYWRpbmcgdGltZQogKiA4KSBAaW1wb3J0IHVybChodHRwOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vZWFybHlhY2Nlc3Mvbm90b3NhbnN0Yy5jc3MpOyB3aWxsIGxvYWQgYWxsIHZlcnNpb24KICogOSkgYWxsIHZlcnNpb24gY3NzLWZvbnQgaGFzIGJpZyBsb2FkaW5nIHNpemUsIGJ1dCB1IGNhbiBzZXQgNSBkaWZmIGZvbnQtd2VpZ2h0IG9uIHBhZ2UKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiAgUHJlLWxvYWQgZ2xvYmFsLWZvbnQgZnJvbSBzZXJ2ZXIncyByZWxhdGl2ZSBwYXRoCiAqICB0aGVuIGFueSBvYmogYW5kIHVzZSB0aGUgZm9udE5hbWUgZm9yIGZvbnQtZmFtaWx5CiAqICBFeDogdjoge2ZvbnRQYXRoOidfY29tL2ZvbnRfbGlnaHQudHRmJyxmb250VHlwZTondHJ1ZXR5cGUnfQogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCmZ1bmN0aW9uIExvYWRHbG9iYWxGb250KHYpIHsKICAgIHZhciBuZXdTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICBuZXdTdHlsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiXApAZm9udC1mYWNlIHtcCiAgICBmb250LWZhbWlseTogJyIgKyB2LmZvbnROYW1lICsgIic7XAogICAgc3JjOiB1cmwoJyIgKyB2LmZvbnRQYXRoICsgIicpIGZvcm1hdCgnIiArIHYuZm9udFR5cGUgKyAiJyk7XAp9XAoiKSk7CiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKG5ld1N0eWxlKTsKCiAgICAvLy0tLS0tIGFwcGx5IGZvbnQtZmFtaWx5IHRvIHdob2xlIGJvZHkgLS0tLS0vLwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jc3NUZXh0ICs9ICdmb250LWZhbWlseTonKyInTWljcm9zb2Z0IEpoZW5nSGVpJywiKyInIit2LmZvbnROYW1lKyInIisnOyc7Cn0KZnVuY3Rpb24gTG9hZEZvbnRBbmRTZXRHbG9iYWwoKSB7CiAgICAvLy0tLS0tIGJlZm9yZSBmb250IGxvYWRlZCwgdXNlIHVzZXIncyBsb2NhbCBmb250IGZvciBkaXNwbGF5IC0tLS0tLy8KICAgIFNldFVzZXJMb2NhbEZvbnRGb3JHbG9iYWwoKTsKICAgIC8vLS0tLS0gc3RhcnQgbG9hZGluZyBmb250IGZyb20gc2VydmVyIC0tLS0tLy8KICAgIHZhciBuZXdTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICBuZXdTdHlsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiXApAZm9udC1mYWNlIHtcCiAgICBmb250LWZhbWlseTogJ05vdG8gU2FucyBUQyc7XAogICAgc3JjOiB1cmwoLy9mb250cy5nc3RhdGljLmNvbS9lYS9ub3Rvc2Fuc3RjL3YxL05vdG9TYW5zVEMtTGlnaHQud29mZjIpIGZvcm1hdCgnd29mZjInKSxcCiAgICB1cmwoLy9mb250cy5nc3RhdGljLmNvbS9lYS9ub3Rvc2Fuc3RjL3YxL05vdG9TYW5zVEMtTGlnaHQud29mZikgZm9ybWF0KCd3b2ZmJyksXAogICAgdXJsKC8vZm9udHMuZ3N0YXRpYy5jb20vZWEvbm90b3NhbnN0Yy92MS9Ob3RvU2Fuc1RDLUxpZ2h0Lm90ZikgZm9ybWF0KCdvcGVudHlwZScpO1wKfVwKICAgIFwKIikpOwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChuZXdTdHlsZSk7CgoKICAgIC8vLS0tLS0gbGV0IGxvYWQtZm9udCBiZWdpbiwgd2UgbmVlZCB0byB1c2UgdGhpcyBmb250IG9uY2UgLS0tLS0vLwogICAgdmFyIHNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBzcy5pbm5lckhUTUwgPSAnZ2lJdFQxV1F5QCEtLyMnOwogICAgc3Muc3R5bGUuY3NzVGV4dCArPSAidmlzaWJpbGl0eTpoaWRkZW47IjsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3MpOwogICAgLy8tLS0tLSBjaGVjayBpZiBuZXcgZm9udCBsb2FkZWQsIHdpbGwgY2hhbmdlIGRpdidzIGNvbnRlbnQgaGVpZ2h0IC0tLS0tLy8KICAgIHZhciBvbGRIID0gc3Mub2Zmc2V0SGVpZ2h0OwogICAgc3Muc3R5bGUuY3NzVGV4dCArPSAnZm9udC1mYW1pbHk6JysiJyIrJ05vdG8gU2FucyBUQycrIiciKyc7JzsKICAgIHZhciB0dCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgIGlmKCBvbGRIICE9IHNzLm9mZnNldEhlaWdodCApIHsKICAgICAgICAgICAgbG9nKHNzLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodHQpOwoKICAgICAgICAgICAgbmV3U3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIlwKICAgICAgICAgICAgICAgICp7XAogICAgICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnTm90byBTYW5zIFRDJztcCiAgICAgICAgICAgICAgICB9XAogICAgICAgICAgICAgICAgIgogICAgICAgICAgICApKTsKICAgICAgICB9CiAgICB9LDUwMCk7Cn0KLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiBQUk9CTEVNUygyMDE3SmFuKToKICogMSkgTm90b1NhbnNUQyBpcyBub3QgYXMgZ29vZCBhcyB3ZSB0aG91Z2ggaW4gYnJvd3NlcidzIGZvbnQgZGlzcGxheQogKiAyKSBUaGlzIGZvbnQgbGV0IHNtYWxsIHRleHQgZGlzcGxheSB3ZWxsLCB3aWxsIHRlc3QgaW4gZnV0dXJlCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogMSkgQmVmb3JlIE5vdG9TYW5zVEMgbG9hZGVkLCB1c2luZyB1c2VyJ3MgbG9jYWwgZm9udCBmb3IgZGVmYXVsdAogKiAyKSBXaGVuIE5vdG9TYW5zVEMgbG9hZCBkb25lLCBtYWtlIE5vdG9TYW5zVEMgZm9yIGRlZmF1bHQgZm9udCBhdXRvbWF0aWNhbGx5CiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KZnVuY3Rpb24gU2V0Tm90b1NhbnNGb3JHbG9iYWxGb250KGRvbmVGdW5jKSB7CgogICAgdmFyIGZlZWRiYWNrT25jZSA9IGZhbHNlOwoKICAgIHZhciBmb250TGlzdCA9ICciU1RIZWl0aSBMaWdodCIsIk1pY3Jvc29mdCBKaGVuZ0hlaSBMaWdodCIsIk1pY3Jvc29mdCBKaGVuZ0hlaSBVSSBMaWdodCIsIkhlbHZldGljYSBOZXVlIiwiSGVsdmV0aWNhLEFyaWFsIiwi44Oh44Kk44Oq44KqIiwi66eR7J2AIOqzoOuUlSIsInNhbnMtc2VyaWYiLCJXZW5RdWFuWWkgWmVuIEhlaSI7JzsKICAgIHZhciBuZXdTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICBuZXdTdHlsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiXAogICAgKntcCiAgICAgICAgZm9udC13ZWlnaHQ6MjAwO1wKICAgICAgICBmb250LWZhbWlseToiK2ZvbnRMaXN0KyJcCiAgICAgfVwKICAgICAiCiAgICApKTsKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobmV3U3R5bGUpOwoKICAgIG5ld1N0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJcCkBmb250LWZhY2Uge1wKICAgIGZvbnQtZmFtaWx5OiAnTm90byBTYW5zIFRDJztcCiAgICBzcmM6IHVybCgvL2ZvbnRzLmdzdGF0aWMuY29tL2VhL25vdG9zYW5zdGMvdjEvTm90b1NhbnNUQy1UaGluLndvZmYyKSBmb3JtYXQoJ3dvZmYyJyksXAogICAgdXJsKC8vZm9udHMuZ3N0YXRpYy5jb20vZWEvbm90b3NhbnN0Yy92MS9Ob3RvU2Fuc1RDLVRoaW4ud29mZikgZm9ybWF0KCd3b2ZmJyksXAogICAgdXJsKC8vZm9udHMuZ3N0YXRpYy5jb20vZWEvbm90b3NhbnN0Yy92MS9Ob3RvU2Fuc1RDLVRoaW4ub3RmKSBmb3JtYXQoJ29wZW50eXBlJyk7XAp9XAogICAgXAoiKSk7CgogICAgRm9udEZhY2VPbmxvYWQoICJOb3RvIFNhbnMgVEMiLCB7CiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmKCAhZmVlZGJhY2tPbmNlICkgewogICAgICAgICAgICAgICAgZmVlZGJhY2tPbmNlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG5ld1N0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJcCiAgICAgICAgICAgICAgICAqe1wKICAgICAgICAgICAgICAgICAgICBmb250LXdlaWdodDoxMDA7XAogICAgICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiIgKyAnTm90byBTYW5zIFRDJyArICJcCiAgICAgICAgICAgICAgICAgfVwKICAgICAgICAgICAgICAgICAiCiAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgIGlmIChpc0lucHV0RnVuY1R5cGUoZG9uZUZ1bmMpKSB7CiAgICAgICAgICAgICAgICAgICAgZG9uZUZ1bmMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwoKfQoKLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiAgU2V0IHdlYi1wYWdlJ3MgZGVmYXVsdC1mb250IGZyb20gbG9jYWwgY29tcHV0ZXIncyBmb250LWxpc3QKIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwpmdW5jdGlvbiBTZXRVc2VyTG9jYWxGb250Rm9yR2xvYmFsKCkgewogICAgdmFyIGZvbnRMaXN0ID0gJyJTVEhlaXRpIExpZ2h0IiwiTWljcm9zb2Z0IEpoZW5nSGVpIExpZ2h0IiwiTWljcm9zb2Z0IEpoZW5nSGVpIFVJIExpZ2h0IiwiSGVsdmV0aWNhIE5ldWUiLCJIZWx2ZXRpY2EsQXJpYWwiLCJzYW5zLXNlcmlmIiwiV2VuUXVhbllpIFplbiBIZWkiOyc7CgogICAgdmFyIG5ld1N0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgIG5ld1N0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJcCiAgICAqe1wKICAgICAgICBmb250LXdlaWdodDozMDA7XAogICAgICAgIGZvbnQtZmFtaWx5OiIrZm9udExpc3QrIlwKICAgICB9XAogICAgICIKICAgICkpOwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChuZXdTdHlsZSk7Cn0KCgoKLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIEVYVEVOREVEIExBUkdFIEZVTkNUSU9OIEZST00gSEVSRQogKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwpTcHJpdGUucHJvdG90eXBlLmluaXRMb2FkaW5nID0gZnVuY3Rpb24odikgewoKICAgIHZhciBzY2FsZVZhbCA9IC40OwogICAgaWYoIGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYuc2NhbGUpICkgewogICAgICAgIHNjYWxlVmFsID0gdi5zY2FsZTsKICAgIH0KCiAgICB0aGlzLm9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5vYmouc3R5bGUuY3NzVGV4dCArPSAncG9zaXRpb246YWJzb2x1dGU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDsnOwogICAgdGhpcy5tYWtlQ3Vyc29yTm9ybWFsKCk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMub2JqKTsKCiAgICB2YXIgb3B0cyA9IHsKICAgICAgICBsaW5lczogMTIgLy8gVGhlIG51bWJlciBvZiBsaW5lcyB0byBkcmF3CiAgICAgICAgLCBsZW5ndGg6IDMwIC8vIFRoZSBsZW5ndGggb2YgZWFjaCBsaW5lCiAgICAgICAgLCB3aWR0aDogNSAvLyBUaGUgbGluZSB0aGlja25lc3MKICAgICAgICAsIHJhZGl1czogNTUgLy8gVGhlIHJhZGl1cyBvZiB0aGUgaW5uZXIgY2lyY2xlCiAgICAgICAgLCBzY2FsZTpzY2FsZVZhbCAvLyBTY2FsZXMgb3ZlcmFsbCBzaXplIG9mIHRoZSBzcGlubmVyCiAgICAgICAgLCBjb3JuZXJzOiAxIC8vIENvcm5lciByb3VuZG5lc3MgKDAuLjEpCiAgICAgICAgLCBjb2xvcjogJyNmZmZmZmYnIC8vICNyZ2Igb3IgI3JyZ2diYiBvciBhcnJheSBvZiBjb2xvcnMKICAgICAgICAsIG9wYWNpdHk6IDAuMyAvLyBPcGFjaXR5IG9mIHRoZSBsaW5lcwogICAgICAgICwgcm90YXRlOiAwIC8vIFRoZSByb3RhdGlvbiBvZmZzZXQKICAgICAgICAsIGRpcmVjdGlvbjogMSAvLyAxOiBjbG9ja3dpc2UsIC0xOiBjb3VudGVyY2xvY2t3aXNlCiAgICAgICAgLCBzcGVlZDogMi4wIC8vIFJvdW5kcyBwZXIgc2Vjb25kCiAgICAgICAgLCB0cmFpbDogNjAgLy8gQWZ0ZXJnbG93IHBlcmNlbnRhZ2UKICAgICAgICAsIGZwczogMjUgLy8gRnJhbWVzIHBlciBzZWNvbmQgd2hlbiB1c2luZyBzZXRUaW1lb3V0KCkgYXMgYSBmYWxsYmFjayBmb3IgQ1NTCiAgICAgICAgLCB6SW5kZXg6IDJlOSAvLyBUaGUgei1pbmRleCAoZGVmYXVsdHMgdG8gMjAwMDAwMDAwMCkKICAgICAgICAsIGNsYXNzTmFtZTogJ3NwaW5uZXInIC8vIFRoZSBDU1MgY2xhc3MgdG8gYXNzaWduIHRvIHRoZSBzcGlubmVyCiAgICAgICAgLCB0b3A6ICc1MCUnIC8vIFRvcCBwb3NpdGlvbiByZWxhdGl2ZSB0byBwYXJlbnQKICAgICAgICAsIGxlZnQ6ICc1MCUnIC8vIExlZnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gcGFyZW50CiAgICAgICAgLCBzaGFkb3c6IGZhbHNlIC8vIFdoZXRoZXIgdG8gcmVuZGVyIGEgc2hhZG93CiAgICAgICAgLCBod2FjY2VsOiB0cnVlIC8vIFdoZXRoZXIgdG8gdXNlIGhhcmR3YXJlIGFjY2VsZXJhdGlvbgogICAgICAgICwgcG9zaXRpb246ICdyZWxhdGl2ZScgLy8gRWxlbWVudCBwb3NpdGlvbmluZwogICAgfTsKICAgIHZhciBzcGlubmVyID0gbmV3IFNwaW5uZXIob3B0cykuc3Bpbih0aGlzLm9iaik7CgogICAgcmV0dXJuIHRoaXMub2JqOwp9OwoKCgovKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBMaXN0Q2VsbC1Gb3IgTGlzdEJveCB1c2FnZShtYXkgdHJlYXQgYXMgYnV0dG9uKQogRXg6dmFyIGNjID0gbmV3IExpc3RDZWxsKHt4OjAseTowfSk7CiBjYy53aGVuQ2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nKCdoZWxsbycpOwogICAgfSk7CiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KZnVuY3Rpb24gTGlzdENlbGwodikgewoKICAgIHZhciBkZWY9ewogICAgICAgIHg6MjAwLAogICAgICAgIHk6MjAwLAogICAgICAgIHdpZHRoOjI1MCwKICAgICAgICBoZWlnaHQ6NjAsCiAgICAgICAgY29sb3JOb3JtYWw6JzRlODg2ZicsCiAgICAgICAgY29sb3JPdmVyOidmNWIzMzMnLAogICAgICAgIGNvbG9yRG93bjonZjU1OTA0JywKICAgICAgICBjb2xvckV2ZW46JzQzNzU1ZicsCiAgICAgICAgdGl0bGU6J0JVVFRPTicsCiAgICAgICAgdGl0bGVTaXplOicyMCcsCiAgICAgICAgdGl0bGVDb2xvcjonZmZmZmZmJywKICAgICAgICB0YWc6JzAnLAogICAgICAgIGljb25UaXRsZURpczoxMAogICAgfTsKCiAgICB2YXIgaWNvbix0aXRsZSx0aXRsZVNpemUsdGl0bGVDb2xvcixjb2xvck5vcm1hbCxjb2xvck92ZXIsY29sb3JEb3duLHh4LHl5LHd3LGhoLHRhZyxpY29uVGl0bGVEaXMsaXNUaXRsZUNlbnRlcjsKICAgIHZhciBjb2xvckV2ZW4sc2hhcGVUcmlhbmdsZSxmdW5jT25DbGljazsKICAgIHZhciBiZ1Jvb3QgPSBudWxsOwogICAgdmFyIGJnVGl0bGUgPSBudWxsOwoKCgogICAgZnVuY3Rpb24gaW5pdFZhcigpIHsKICAgICAgICB0YWcgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LnRhZyk/di50YWc6ZGVmLnRhZzsKICAgICAgICBpc1RpdGxlQ2VudGVyID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0T2JqZWN0KHYuaWNvbik/ZmFsc2U6dHJ1ZTsKICAgICAgICBpY29uID0gaXNUaXRsZUNlbnRlcj9udWxsOnYuaWNvbjsKICAgICAgICBpY29uVGl0bGVEaXMgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2Lmljb25UaXRsZURpcyk/di5pY29uVGl0bGVEaXM6ZGVmLmljb25UaXRsZURpczsKICAgICAgICB4eCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYueCk/di54OmRlZi54OwogICAgICAgIHl5ID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi55KT92Lnk6ZGVmLnk7CiAgICAgICAgd3cgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LndpZHRoKT92LndpZHRoOmRlZi53aWR0aDsKICAgICAgICBoaCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYuaGVpZ2h0KT92LmhlaWdodDpkZWYuaGVpZ2h0OwogICAgICAgIGNvbG9yTm9ybWFsID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0U3RyaW5nKHYuY29sb3JOb3JtYWwpP3YuY29sb3JOb3JtYWw6ZGVmLmNvbG9yTm9ybWFsOwogICAgICAgIGNvbG9yRG93biA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFN0cmluZyh2LmNvbG9yRG93bik/di5jb2xvckRvd246ZGVmLmNvbG9yRG93bjsKICAgICAgICBjb2xvck92ZXIgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRTdHJpbmcodi5jb2xvck92ZXIpP3YuY29sb3JPdmVyOmRlZi5jb2xvck92ZXI7CiAgICAgICAgY29sb3JFdmVuID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0U3RyaW5nKHYuY29sb3JFdmVuKT92LmNvbG9yRXZlbjpkZWYuY29sb3JFdmVuOwogICAgICAgIHRpdGxlID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0U3RyaW5nKHYudGl0bGUpP3YudGl0bGU6ZGVmLnRpdGxlOwogICAgICAgIHRpdGxlU2l6ZSA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFN0cmluZyh2LnRpdGxlU2l6ZSk/di50aXRsZVNpemU6ZGVmLnRpdGxlU2l6ZTsKICAgICAgICB0aXRsZUNvbG9yID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0U3RyaW5nKHYudGl0bGVDb2xvcik/di50aXRsZUNvbG9yOmRlZi50aXRsZUNvbG9yOwoKICAgICAgICAvLy0tLS0tIHdoZW4gY2VsbCdzIGluZGV4IGlzIGV2ZW4sIG1ha2UgYmcgY29sb3IgbGl0dGxlIGRhcmtlciAtLS0tLS8vCiAgICAgICAgaWYoIHRhZyUyIT0wICkgewogICAgICAgICAgICBjb2xvck5vcm1hbCA9IGNvbG9yRXZlbjsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdEJnUm9vdCgpIHsKICAgICAgICBiZ1Jvb3QgPSBuZXcgU3ByaXRlKCk7CiAgICAgICAgYmdSb290LmluaXREaXYoKTsKICAgICAgICBiZ1Jvb3QudG9wKHl5KTsKICAgICAgICBiZ1Jvb3QubGVmdCh4eCk7CiAgICAgICAgYmdSb290LndpZHRoKHd3KTsKICAgICAgICBiZ1Jvb3QuaGVpZ2h0KGhoKTsKICAgICAgICBiZ1Jvb3QuY29sb3JIZXgoY29sb3JOb3JtYWwpOwogICAgICAgIGJnUm9vdC50YWcgPSB0YWc7CiAgICAgICAgYmdSb290LmFkZE1vdXNlT3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgYmdSb290LmNvbG9ySGV4KGNvbG9yT3Zlcik7CiAgICAgICAgICAgIGlmKGlzSW5wdXRPYmplY3Qoc2hhcGVUcmlhbmdsZSkpCiAgICAgICAgICAgICAgICBzaGFwZVRyaWFuZ2xlLnRyaWFuZ2xlQ29sb3IoY29sb3JPdmVyKTsKICAgICAgICB9KTsKICAgICAgICBiZ1Jvb3QuYWRkTW91c2VPdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGJnUm9vdC5jb2xvckhleChjb2xvck5vcm1hbCk7CiAgICAgICAgICAgIGlmKGlzSW5wdXRPYmplY3Qoc2hhcGVUcmlhbmdsZSkpCiAgICAgICAgICAgICAgICBzaGFwZVRyaWFuZ2xlLnRyaWFuZ2xlQ29sb3IoY29sb3JOb3JtYWwpOwogICAgICAgIH0pOwogICAgICAgIGJnUm9vdC5hZGRNb3VzZURvd24oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGJnUm9vdC5jb2xvckhleChjb2xvckRvd24pOwogICAgICAgICAgICBpZihpc0lucHV0T2JqZWN0KHNoYXBlVHJpYW5nbGUpKQogICAgICAgICAgICAgICAgc2hhcGVUcmlhbmdsZS50cmlhbmdsZUNvbG9yKGNvbG9yRG93bik7CiAgICAgICAgfSk7CiAgICAgICAgYmdSb290LmFkZE1vdXNlVXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGJnUm9vdC5jb2xvckhleChjb2xvck92ZXIpOwogICAgICAgICAgICBpZihpc0lucHV0T2JqZWN0KHNoYXBlVHJpYW5nbGUpKQogICAgICAgICAgICAgICAgc2hhcGVUcmlhbmdsZS50cmlhbmdsZUNvbG9yKGNvbG9yT3Zlcik7CiAgICAgICAgfSk7CiAgICAgICAgYmdSb290LmFkZE1vdXNlQ2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmKGlzSW5wdXRWYWxpZChmdW5jT25DbGljaykpCiAgICAgICAgICAgICAgICBmdW5jT25DbGljayhiZ1Jvb3QudGFnKTsKICAgICAgICB9KTsKICAgIH0KCgogICAgZnVuY3Rpb24gaW5pdEljb25UaXRsZSgpIHsKICAgICAgICBpZiggaXNUaXRsZUNlbnRlciApIHsKICAgICAgICAgICAgYmdUaXRsZSA9IG5ldyBTcHJpdGUoKTsKICAgICAgICAgICAgYmdUaXRsZS5pbml0RGl2KCk7CiAgICAgICAgICAgIGJnVGl0bGUud2lkdGgoYmdSb290LndpZHRoKCktMjApOwogICAgICAgICAgICBiZ1RpdGxlLmhlaWdodChiZ1Jvb3QuaGVpZ2h0KCktMTApOwogICAgICAgICAgICBiZ1RpdGxlLmFwcGx5VGV4dCh0aXRsZSk7CiAgICAgICAgICAgIGJnVGl0bGUudGV4dFNpemUodGl0bGVTaXplKTsKICAgICAgICAgICAgYmdUaXRsZS50ZXh0Q29sb3IodGl0bGVDb2xvcik7CiAgICAgICAgICAgIGJnVGl0bGUuYWxpZ25DZW50ZXIoKTsKICAgICAgICAgICAgYmdUaXRsZS50ZXh0QWxpZ25DZW50ZXIoKTsKICAgICAgICAgICAgYmdUaXRsZS5tYWtlQ3Vyc29yTm9ybWFsKCk7CiAgICAgICAgICAgIGJnUm9vdC5hZGRDaGlsZChiZ1RpdGxlKTsKICAgICAgICB9CiAgICB9CgoKCgogICAgaW5pdFZhcigpOwogICAgaW5pdEJnUm9vdCgpOwogICAgaW5pdEljb25UaXRsZSgpOwoKCgogICAgdGhpcy50YWcgPSB0YWcgPSAwOwogICAgdGhpcy5nZXRDZWxsSGVpZ2h0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGJnUm9vdC5oZWlnaHQoKTsKICAgIH07CiAgICB0aGlzLnNldFNoYXBlVHJpYW5nbGUgPSBmdW5jdGlvbih2KSB7CiAgICAgICAgaWYoIGlzSW5wdXRPYmplY3QodikgKQogICAgICAgICAgICBzaGFwZVRyaWFuZ2xlID0gdjsKICAgIH07CiAgICB0aGlzLndoZW5DbGljayA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgICAgICBmdW5jT25DbGljayA9IGZ1bmM7CiAgICB9OwogICAgdGhpcy5nZXRUZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRpdGxlOwogICAgfTsKICAgIHRoaXMuYmcgPSBiZ1Jvb3Q7Cgp9CgoKLyoqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogQSkgTGlzdEJveCdzIHgseSB3aWxsIGJlY29tZSBjZW50ZXItdG9wIG9mIHRoZSBzaGFwZS10cmlhbmdsZQogQikgbWVtb3J5IHRlc3QtLT5tZW1vcnkgcmVsZWFzZSBvawogQykgZnVuY3Rpb24ncyBwYXJhbWV0ZXIgcGxzIHJlZmVyIHRvIGRlZiBpbnNpZGUgZnVuYwogRCkgYWRkIGxpc3RlbmVyOndoZW5Vc2VyU2VsZWN0ZWQgd2hlbiBsaXN0IGJlZW4gc2VsZWN0ZWQKIEV4OgogdmFyIGFyck5hbWUgPSBbIkhlbGxvIiwiU3VuZGF5IiwiV29vZHMiXTsKIG5ldyBMaXN0Qm94KHt4OjMxMCx5OjExMCxhcnJDZWxsOmFyck5hbWUsY2VsbEg6NTAsdzoyMzAsdGV4dFNpemU6JzI3J30pOwogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KZnVuY3Rpb24gTGlzdEJveCh2KSB7CgogICAgdmFyIGRlZj17CiAgICAgICAgeDoyMDAsCiAgICAgICAgeToyMDAsCiAgICAgICAgdzoyNzAsCiAgICAgICAgaDo2MCwKICAgICAgICBpc1Njcm9sbEJhcjpmYWxzZSwKICAgICAgICBjb3JuZXJSOjEwLAogICAgICAgIHRTaGFwZVc6MjAsCiAgICAgICAgdFNoYXBlSDoxMCwKICAgICAgICBjZWxsSDozMCwKICAgICAgICBjb2xvck5vcm1hbDonNGU4ODZmJywKICAgICAgICBjb2xvck92ZXI6J2Y1YjMzMycsCiAgICAgICAgY29sb3JEb3duOidmNTU5MDQnLAogICAgICAgIGNvbG9yRXZlbjonNDM3NTVmJywKICAgICAgICBjb2xvclRleHQ6J2ZmZmZmZicsCiAgICAgICAgdGV4dFNpemU6JzIwJywKICAgICAgICBpc1NoYWRvdzp0cnVlCiAgICB9OwoKICAgIHZhciB4LHksdyxoLGlzU2Nyb2xsQmFyLGNvcm5lclIsdFNoYXBlVyx0U2hhcGVILGlzQ2VsbEV4aXN0LGNlbGxIOwogICAgdmFyIGNlbGxUb3RhbEhlaWdodCxjb2xvck5vcm1hbCxjb2xvck92ZXIsY29sb3JEb3duLGNvbG9yRXZlbixjb2xvclRleHQsdGV4dFNpemU7CiAgICB2YXIgYmdSb290LGJnUm91bmQsYmdUU2hhcGUgPSBudWxsOwogICAgLy8tLS0tLSBtb3JlIHNwYWNlIGZvciBiZ1JvdW5kJ3Mgc2hhZG93IC0tLS0tLy8KICAgIHZhciBib3JkZXJEaXMgPSAyMDsKICAgIC8vLS0tLS0gZmluYWwgc3RyaW5nIHNlbGVjdGVkIGJ5IHVzZXIgZnJvbSBsaXN0IC0tLS0tLy8KICAgIHZhciBhbnMgPSBudWxsOwogICAgLy8tLS0tLSBhcnIgZm9yIHN0b3JlIGNlbGxzIC0tLS0tLy8KICAgIHZhciBhcnIgPSB7fTsKICAgIC8vLS0tLS0gZnVsbC1zY3JlZW4gb2YgYmcgLS0tLS0vLwogICAgdmFyIGJnTW90aGVyID0gbnVsbDsKICAgIC8vLS0tLS0gZnVsbC1zY3JlZW4gdG91Y2ggYXJlYSBmb3IgbW91c2UtZG93biBhbmQgZXhpdCAtLS0tLS8vCiAgICB2YXIgYmdFeGl0ID0gbnVsbDsKICAgIC8vLS0tLS0gYXNzaWduIGZyb20gb3V0c2lkZSBmb3Igd2hlbiBjZWxsLWNsaWNrIC0tLS0tLy8KICAgIHZhciBjbGllbnRGdW5jID0gbnVsbDsKCgoKICAgIGZ1bmN0aW9uIGluaXRWYXIoKSB7CiAgICAgICAgeCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYueCk/di54OmRlZi54OwogICAgICAgIHkgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LnkpP3YueTpkZWYueTsKICAgICAgICB3ID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi53KT92Lnc6ZGVmLnc7CiAgICAgICAgaCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYuaCk/di5oOmRlZi5oOwogICAgICAgIGlzU2Nyb2xsQmFyID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0Qm9vbGVhbih2LmlzU2Nyb2xsQmFyKT92LmlzU2Nyb2xsQmFyOmRlZi5pc1Njcm9sbEJhcjsKICAgICAgICBjb3JuZXJSID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi5jb3JuZXJSKT92LmNvcm5lclI6ZGVmLmNvcm5lclI7CiAgICAgICAgdFNoYXBlVyA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYudFNoYXBlVyk/di50U2hhcGVXOmRlZi50U2hhcGVXOwogICAgICAgIHRTaGFwZUggPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LnRTaGFwZUgpP3YudFNoYXBlSDpkZWYudFNoYXBlSDsKICAgICAgICBpc0NlbGxFeGlzdCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dEFycmF5KHYuYXJyQ2VsbCk7CiAgICAgICAgY2VsbEggPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LmNlbGxIKT92LmNlbGxIOmRlZi5jZWxsSDsKICAgICAgICBjb2xvck5vcm1hbCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFN0cmluZyh2LmNvbG9yTm9ybWFsKT92LmNvbG9yTm9ybWFsOmRlZi5jb2xvck5vcm1hbDsKICAgICAgICBjb2xvckRvd24gPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRTdHJpbmcodi5jb2xvckRvd24pP3YuY29sb3JEb3duOmRlZi5jb2xvckRvd247CiAgICAgICAgY29sb3JPdmVyID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0U3RyaW5nKHYuY29sb3JPdmVyKT92LmNvbG9yT3ZlcjpkZWYuY29sb3JPdmVyOwogICAgICAgIGNvbG9yRXZlbiA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFN0cmluZyh2LmNvbG9yRXZlbik/di5jb2xvckV2ZW46ZGVmLmNvbG9yRXZlbjsKICAgICAgICBjb2xvclRleHQgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRTdHJpbmcodi5jb2xvclRleHQpP3YuY29sb3JUZXh0OmRlZi5jb2xvclRleHQ7CiAgICAgICAgdGV4dFNpemUgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRTdHJpbmcodi50ZXh0U2l6ZSk/di50ZXh0U2l6ZTpkZWYudGV4dFNpemU7CiAgICB9CgogICAgZnVuY3Rpb24gZXhpdCgpIHsKICAgICAgICBiZ01vdGhlci5yZW1vdmVGcm9tUGFyZW50KCk7CiAgICAgICAgYmdNb3RoZXIgPSBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRCZ01vdGhlcigpIHsKICAgICAgICBiZ01vdGhlciA9IG5ldyBTcHJpdGUoKTsKICAgICAgICBiZ01vdGhlci5pbml0RGl2KCk7CiAgICAgICAgYmdNb3RoZXIuZnJhbWUoMCwwLCcxMDAlJywnMTAwJScpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRCZ0V4aXQoKSB7CiAgICAgICAgYmdFeGl0ID0gbmV3IFNwcml0ZSgpOwogICAgICAgIGJnRXhpdC5pbml0RGl2KCk7CiAgICAgICAgYmdFeGl0LmZyYW1lKDAsMCwnMTAwJScsJzEwMCUnKTsKICAgICAgICBiZ0V4aXQuYWRkTW91c2VEb3duKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBleGl0KCk7CiAgICAgICAgfSk7CiAgICAgICAgYmdNb3RoZXIuYWRkQ2hpbGQoYmdFeGl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0QmdSb290KCkgewogICAgICAgIGJnUm9vdCA9IG5ldyBTcHJpdGUoKTsKICAgICAgICBiZ1Jvb3QuaW5pdERpdigpOwogICAgICAgIGJnUm9vdC50b3AoeSk7CiAgICAgICAgYmdSb290LmxlZnQoeC0odytib3JkZXJEaXMpLzIpOy8vKHgtYm9yZGVyRGlzLzIpOwogICAgICAgIGJnUm9vdC53aWR0aCh3K2JvcmRlckRpcyk7CiAgICAgICAgYmdSb290LmhlaWdodChoKTsgICAgICAgICAgICAgICAvLyBiZ1Jvb3QncyBoZWlnaHQgbWF5IGNoYW5nZSBsYXRlciBpbiBpbml0Q2VsbCgpCi8vICAgICAgICBiZ1Jvb3QuY29sb3JIZXgoJzAwMDA5OScpOyAgICAgIC8vIGRlYnVnLXVzYWdlCiAgICAgICAgYmdNb3RoZXIuYWRkQ2hpbGQoYmdSb290KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0VFNoYXBlKCkgewogICAgICAgIGJnVFNoYXBlID0gbmV3IFNwcml0ZSgpOwogICAgICAgIGJnVFNoYXBlLmluaXRUcmlhbmdsZShudWxsLHRTaGFwZVcsdFNoYXBlSCxjb2xvck5vcm1hbCk7CiAgICAgICAgYmdUU2hhcGUuYWxpZ25DZW50ZXJIb3Jpem9udGFsKCk7CiAgICAgICAgYmdSb290LmFkZENoaWxkKGJnVFNoYXBlKTsKICAgIH0KCgogICAgZnVuY3Rpb24gaW5pdFJvdW5kQmcoKSB7CiAgICAgICAgYmdSb3VuZCA9IG5ldyBTcHJpdGUoKTsKICAgICAgICBiZ1JvdW5kLmluaXREaXYoKTsKICAgICAgICBiZ1JvdW5kLnRvcCh0U2hhcGVILTEpOwogICAgICAgIGJnUm91bmQubGVmdChib3JkZXJEaXMvMik7CiAgICAgICAgYmdSb3VuZC53aWR0aCh3KTtiZ1JvdW5kLmhlaWdodChoLXRTaGFwZUgpOwogICAgICAgIGJnUm91bmQuY29sb3JIZXgoY29sb3JOb3JtYWwpOwogICAgICAgIGJnUm91bmQuY29ybmVyUmFkaXVzKGNvcm5lclIpOwogICAgICAgIGJnUm9vdC5hZGRDaGlsZChiZ1JvdW5kKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0U2hhZG93KCkgewogICAgICAgIC8vLS0tLS0gd2hlbiB1c2VyIGRlZmluZSBpc1NoYWRvdz1mYWxzZSB3aWxsIG5vdCBydW4gdGhpcyBmdW5jIC0tLS0tLy8KICAgICAgICBpZiggIShpc0lucHV0VmFsaWQodikmJmlzSW5wdXRCb29sZWFuKHYuaXNTaGFkb3cpJiYhdi5pc1NoYWRvdykgKQogICAgICAgICAgICBiZ1JvdW5kLnNoYWRvdygwLDAsMTUsLjcpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRDZWxsKCkgewoKICAgICAgICAvLy0tLS0tIHVzZXIgZGVmaW5lIGNlbGwncyBuYW1lIG9yIG5vdCAtLS0tLS8vCiAgICAgICAgaWYoIGlzQ2VsbEV4aXN0ICkgewogICAgICAgICAgICBmb3IoIHZhciBpPTA7IGk8di5hcnJDZWxsLmxlbmd0aDtpKyspIHsKICAgICAgICAgICAgICAgIHZhciBwb3N5ID0gKGkqY2VsbEgpOwogICAgICAgICAgICAgICAgdmFyIGNjID0gbmV3IExpc3RDZWxsKHsKICAgICAgICAgICAgICAgICAgICB4OjAseTpwb3N5LHRpdGxlOnYuYXJyQ2VsbFtpXSx0YWc6aSx3aWR0aDp3LGhlaWdodDpjZWxsSCwKICAgICAgICAgICAgICAgICAgICBjb2xvck5vcm1hbDpjb2xvck5vcm1hbCxjb2xvck92ZXI6Y29sb3JPdmVyLGNvbG9yRG93bjpjb2xvckRvd24sdGl0bGVDb2xvcjpjb2xvclRleHQsCiAgICAgICAgICAgICAgICAgICAgdGl0bGVTaXplOnRleHRTaXplLGNvbG9yRXZlbjpjb2xvckV2ZW4KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY2Mud2hlbkNsaWNrKHdoZW5DZWxsQ2xpY2spOwogICAgICAgICAgICAgICAgYmdSb3VuZC5hZGRDaGlsZChjYy5iZyk7CiAgICAgICAgICAgICAgICBhcnJbaV0gPSBjYzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLy0tLS0tIHVwZGF0ZSBiZyBhbmQgYmctcm91bmRlZCdzIGhlaWdodCBieSBjZWxsIC0tLS0tLy8KICAgICAgICAgICAgdmFyIGNjYyA9IGFyclswXTsKICAgICAgICAgICAgY2VsbFRvdGFsSGVpZ2h0ID0gY2NjLmdldENlbGxIZWlnaHQoKSoodi5hcnJDZWxsLmxlbmd0aCk7CiAgICAgICAgICAgIGJnUm9vdC5oZWlnaHQoY2VsbFRvdGFsSGVpZ2h0K3RTaGFwZUgrYm9yZGVyRGlzKTsKICAgICAgICAgICAgYmdSb3VuZC5oZWlnaHQoY2VsbFRvdGFsSGVpZ2h0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgZGQgPSBuZXcgTGlzdENlbGwoewogICAgICAgICAgICAgICAgdGl0bGU6J2VtcHR5Jyx3aWR0aDp3LGhlaWdodDpjZWxsSCx4OjAseTowLHRhZzowLAogICAgICAgICAgICAgICAgY29sb3JOb3JtYWw6Y29sb3JOb3JtYWwsY29sb3JPdmVyOmNvbG9yT3Zlcixjb2xvckRvd246Y29sb3JEb3duLHRpdGxlQ29sb3I6Y29sb3JUZXh0LAogICAgICAgICAgICAgICAgdGl0bGVTaXplOnRleHRTaXplLGNvbG9yRXZlbjpjb2xvckV2ZW4KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRkLndoZW5DbGljayh3aGVuQ2VsbENsaWNrKTsKICAgICAgICAgICAgYmdSb290LmhlaWdodChkZC5nZXRDZWxsSGVpZ2h0KCkrdFNoYXBlSCtib3JkZXJEaXMpOwogICAgICAgICAgICBiZ1JvdW5kLmhlaWdodChkZC5nZXRDZWxsSGVpZ2h0KCkpOwogICAgICAgICAgICBiZ1JvdW5kLmFkZENoaWxkKGRkLmJnKTsKICAgICAgICAgICAgYXJyWzBdID0gZGQ7CiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tIG1ha2Ugc2hhcGUtdHJpYW5nbGUncyBtb3VzZS1ldmVudC1jb2xvciBzYW1lIHdpdGggZmlyc3QgY2VsbCAtLS0tLS8vCiAgICAgICAgdmFyIGNjY2MgPSBhcnJbMF07CiAgICAgICAgY2NjYy5zZXRTaGFwZVRyaWFuZ2xlKGJnVFNoYXBlKTsKICAgIH0KCgoKCgogICAgLy8tLS0tLSBtb3VzZS1jbGljayBieSB1c2VyIC0tLS0tLy8KICAgIGZ1bmN0aW9uIHdoZW5DZWxsQ2xpY2sodikgewogICAgICAgIGFucyA9IGFyclt2XS5nZXRUZXh0KCk7CiAgICAgICAgaWYoaXNJbnB1dEZ1bmNUeXBlKGNsaWVudEZ1bmMpKSB7CiAgICAgICAgICAgIGNsaWVudEZ1bmMoYW5zKTsKICAgICAgICB9CiAgICAgICAgZXhpdCgpOwogICAgfQoKCgoKCgogICAgaW5pdFZhcigpOwogICAgaW5pdEJnTW90aGVyKCk7CiAgICBpbml0QmdFeGl0KCk7CiAgICBpbml0QmdSb290KCk7CiAgICBpbml0Um91bmRCZygpOwogICAgaW5pdFRTaGFwZSgpOwogICAgaW5pdENlbGwoKTsKICAgIGluaXRTaGFkb3coKTsKCgogICAgdGhpcy53aGVuVXNlclNlbGVjdGVkID0gZnVuY3Rpb24oZnVuYyl7CiAgICAgICAgY2xpZW50RnVuYyA9IGZ1bmM7CiAgICB9OwogICAgdGhpcy5iZyA9IGJnTW90aGVyOwoKfQoKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICogU2Nyb2xsVmlldwogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiB2IGNvdWxkIGJlIHt4OjEwLHk6MTAsdzoxMDAsaDoxMDAsaXNCYXJXaGl0ZTp0cnVlLGJnQ29sb3I6JzAwOTkwMCd9CiAqIGlzQmFyV2hpdGU6IHNjcm9sbC1iYXIgaGFzIDIgZGlmZiBraW5kcyBvZiBjb2xvci1zdHlsZSwgYmxhY2sgb3Igd2hpdGUKICogYmdDb2xvcjogc2Nyb2xsVmlldydzIGJhY2tncm91bmQgY29sb3IsIHRyYW5zcGFyZW50IGJ5IGRlZmF1bHQKICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KZnVuY3Rpb24gU2Nyb2xsVmlldyh2KSB7CgogICAgLy8tLS0tLSBjbGVhbiBhbGwgY2VsbCBhbmQgcmVzZXQgc2Nyb2xsLWJhciAtLS0tLS8vCiAgICB0aGlzLmNsZWFuQWxsQ2VsbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJlc2V0U2Nyb2xsVmlldygpOwogICAgfTsKICAgIC8vLS0tLS0gYWRkIG9uZSBjZWxsIGVhY2ggdGltZSAtLS0tLS8vCiAgICB0aGlzLmFkZENlbGwgPSBmdW5jdGlvbihjKSB7CiAgICAgICAgYWRkQ2VsbDJTY3JvbGxWaWV3KGMpOwogICAgfTsKICAgIC8vLS0tLS0gdXBkYXRlIGNvbnRlbnQgYnkgYXJyYXkgb2YgY2VsbCAtLS0tLS8vCiAgICB0aGlzLmFkZENlbGxBcnIgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgcmVzZXRTY3JvbGxWaWV3KCk7CiAgICAgICAgYS5mb3JFYWNoKGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgYWRkQ2VsbDJTY3JvbGxWaWV3KGMpOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgeHggPSAwOwogICAgdmFyIHl5ID0gMDsKICAgIHZhciB3dyA9IDMwMDsKICAgIHZhciBoaCA9IDMwMDsKICAgIHZhciBjb250ZW50SCA9IDA7ICAgICAgICAgICAgICAgLy8gbWFrZSBzY3JvbGwtYmFyIGFwcGVhciBvbmx5IHdoZW4gY29udGVudEg+aGgKICAgIHZhciBiYXJXaWR0aE1pbiA9IDEwOyAgICAgICAgICAgLy8gc2Nyb2xsLWJhcidzIHdpZHRoIHdoZW4gbm9ybWFsCiAgICB2YXIgYmFyV2lkdGhNYXggPSAxODsgICAgICAgICAgIC8vIHNjcm9sbC1iYXIncyB3aWR0aCB3aGVuIG1vdXNlLW92ZXIKICAgIHZhciBpc0JhckNvbG9yV2hpdGUgPSBmYWxzZTsgICAgLy8gY29sb3Itc3R5bGUgd2hpdGUgb3IgYmxhY2sgZm9yIHNjcm9sbC1iYXIKICAgIHZhciBiYXJBbHBoYSA9IC40OwogICAgdmFyIGJhckFuaVNwZWVkID0gLjE1OwogICAgdmFyIGJhckF1dG9IaWRlVGltZSA9IDMwMDA7ICAgICAvLyAzIHNlYwoKCiAgICBpbml0VmFyKCk7CgoKICAgIGZ1bmN0aW9uIGluaXRWYXIoKSB7CiAgICAgICAgeHggPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LngpP3YueDp4eDsKICAgICAgICB5eSA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYueSk/di55Onl5OwogICAgICAgIHd3ID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi53KT92Lnc6d3c7CiAgICAgICAgaGggPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LmgpP3YuaDpoaDsKICAgICAgICBpc0JhckNvbG9yV2hpdGUgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LmlzQmFyV2hpdGUpP3YuaXNCYXJXaGl0ZTppc0JhckNvbG9yV2hpdGU7CiAgICB9CgogICAgLy8tLS0tLSBpZiBjZWxsIGV4aXN0LCByZW1vdmUgYWxsIGNlbGwgYW5kIHJlc2V0IHNjcm9sbC1iYXIgLS0tLS0vLwogICAgZnVuY3Rpb24gcmVzZXRTY3JvbGxWaWV3KCkgewogICAgICAgIGlmKCBiZ1Njcm9sbEJhc2Uub2JqLmhhc0NoaWxkTm9kZXMoKSApIHsKICAgICAgICAgICAgYmdTY3JvbGxCYXNlLnJlbW92ZUFsbENoaWxkKCk7CiAgICAgICAgICAgIGNvbnRlbnRIID0gMDsKICAgICAgICAgICAgdXBkYXRlU2Nyb2xsU3RhdGUoKTsKICAgICAgICAgICAgc2Nyb2xsYmFyLnRvcCgwKTsKICAgICAgICB9CiAgICB9CgogICAgLy8tLS0tLSB1cGRhdGUgc2Nyb2xsLWRpcyBhbmQgc2Nyb2xsLWJhcidzIGhlaWdodCBieSBjZWxsLWNvbnRlbnQgLS0tLS0vLwogICAgZnVuY3Rpb24gdXBkYXRlU2Nyb2xsU3RhdGUoKSB7CiAgICAgICAgaWYoIGNvbnRlbnRIID4gaGggKSB7CiAgICAgICAgICAgIHNjcm9sbGJhci5oaWRkZW4oZmFsc2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNjcm9sbGJhci5oaWRkZW4odHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGNvbnRlbnQuaGVpZ2h0KGNvbnRlbnRIKTsKICAgICAgICBzY3JvbGxiYXIuaGVpZ2h0KCBnZXRCYXJIKCkgKTsKICAgICAgICBzY3JvbGxEaXNNYXggPSBiZ1Jvb3QuaGVpZ2h0KCktc2Nyb2xsYmFyLmhlaWdodCgpOwogICAgfQoKICAgIC8vLS0tLS0gYWRkIGNlbGwgYW5kIHVwZGF0ZSBjb250ZW50J3MgaGVpZ2h0IC0tLS0tLy8KICAgIGZ1bmN0aW9uIGFkZENlbGwyU2Nyb2xsVmlldyhjKSB7CiAgICAgICAgYmdTY3JvbGxCYXNlLmFkZENoaWxkKGMpOwogICAgICAgIC8vLS0tLS0gdXBkYXRlIHNjcm9sbCBkaXMgLS0tLS0vLwogICAgICAgIGNvbnRlbnRIICs9IGMuaGVpZ2h0KCk7CiAgICAgICAgdXBkYXRlU2Nyb2xsU3RhdGUoKTsKICAgIH0KCgoKCiAgICB2YXIgYmdSb290ID0gbmV3IFNwcml0ZSgpOwogICAgYmdSb290LmluaXREaXYoKTsKICAgIGlmKCBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LmJnQ29sb3IpICkgewogICAgICAgIGJnUm9vdC5jb2xvckhleCh2LmJnQ29sb3IpOwogICAgfQogICAgYmdSb290LmZyYW1lKHh4LHl5LHd3LGhoKTsKCgogICAgdmFyIGNvbnRlbnQgPSBuZXcgU3ByaXRlKCk7CiAgICBjb250ZW50LmluaXREaXYoKTsKICAgIGNvbnRlbnQuZnJhbWUoMCwwLDIsY29udGVudEgpOwoKICAgIHZhciBiZ1Njcm9sbEJhc2UgPSBuZXcgU3ByaXRlKCk7CiAgICBiZ1Njcm9sbEJhc2UuaW5pdERpdigpOwogICAgYmdTY3JvbGxCYXNlLmZyYW1lKDAsMCxiZ1Jvb3Qud2lkdGgoKSsyMCxiZ1Jvb3QuaGVpZ2h0KCkpOwogICAgYmdTY3JvbGxCYXNlLnNjcm9sbFZlcnRpY2FsKCk7CiAgICBiZ1Njcm9sbEJhc2UuYWRkQ2hpbGQoY29udGVudCk7CiAgICBiZ1Jvb3QuYWRkQ2hpbGQoYmdTY3JvbGxCYXNlKTsKCiAgICAvLy0tLS0tIGdldCBzY3JvbGwtYmFyJ3MgaGVpZ2h0IGJhc2VkIG9uIGJnIGFuZCBjZWxsLWNvbnRlbnQncyBoZWlnaHQgLS0tLS0vLwogICAgZnVuY3Rpb24gZ2V0QmFySCgpIHsKICAgICAgICByZXR1cm4gYmdSb290LmhlaWdodCgpKihiZ1Jvb3QuaGVpZ2h0KCkvY29udGVudC5oZWlnaHQoKSk7CiAgICB9CiAgICAvLy0tLS0tIG1ha2Ugc2Nyb2xsLWJhciBiaWdnZXIgd2hlbiB1c2VyIHdhbnRzIHRvIGRyYWcgb24gaXQgLS0tLS0vLwogICAgZnVuY3Rpb24gbWFrZUJhckJpZ2dlcih2KSB7CiAgICAgICAgaWYoIGlzSW5wdXRCb29sZWFuKHYpICkgewogICAgICAgICAgICBpZiggdj09dHJ1ZSApIHsKICAgICAgICAgICAgICAgIHNjcm9sbGJhci5hbmlCeUNTUyhiYXJBbmlTcGVlZCx7d2lkdGg6YmFyV2lkdGhNYXgsYm9yZGVyUmFkaXVzOmJhcldpZHRoTWF4LzJ9LGZhbHNlLG51bGwpOwogICAgICAgICAgICAgICAgLy8tLS0tLSB3aGVuIHJlYWR5IGRyYWdnaW5nIGJhciwgZGlzYWJsZSBiYXIncyBhdXRvIGhpZGUgLS0tLS0vLwogICAgICAgICAgICAgICAgc2Nyb2xsYmFyQW5pSGlkZShmYWxzZSk7CiAgICAgICAgICAgICAgICBzdGFydEJhckF1dG9IaWRlVGltZXIoZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2Nyb2xsYmFyLmFuaUJ5Q1NTKGJhckFuaVNwZWVkLHt3aWR0aDpiYXJXaWR0aE1pbixib3JkZXJSYWRpdXM6YmFyV2lkdGhNaW4vMn0sZmFsc2UsbnVsbCk7CiAgICAgICAgICAgICAgICAvLy0tLS0tIHdoZW4gbm90IGRyYWdnaW5nIC0tLS0tLy8KICAgICAgICAgICAgICAgIGlmKCFpc0FsbG93RHJhZykKICAgICAgICAgICAgICAgICAgICBzdGFydEJhckF1dG9IaWRlVGltZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB2YXIgaXNBbGxvd0RyYWcgPSBmYWxzZTsKICAgIHZhciBkcmFnUG9zWVN0YXJ0ID0gMDsKICAgIHZhciBkcmFnUG9zWUVuZCA9IDA7CiAgICB2YXIgbGFzdEJhclBvc1kgPSAwOwogICAgdmFyIGRyYWdEaXMgPSAwOwogICAgdmFyIHNjcm9sbGJhciA9IG5ldyBTcHJpdGUoKTsKICAgIHNjcm9sbGJhci5pbml0RGl2KCk7CiAgICBzY3JvbGxiYXIuZnJhbWUobnVsbCwwLGJhcldpZHRoTWluLDUwLDMsbnVsbCk7CiAgICBpZiggaXNCYXJDb2xvcldoaXRlICkgewogICAgICAgIHNjcm9sbGJhci5jb2xvckhleCgnZmZmZmZmJyk7CiAgICB9IGVsc2UgewogICAgICAgIHNjcm9sbGJhci5jb2xvckhleCgnMDAwMDAwJyk7CiAgICB9CiAgICBzY3JvbGxiYXIuYm9yZGVyKC4xLCc5MDkwOTAnLHRydWUpOwogICAgc2Nyb2xsYmFyLmFscGhhKGJhckFscGhhKTsKICAgIHNjcm9sbGJhci5jb3JuZXJSYWRpdXMoc2Nyb2xsYmFyLndpZHRoKCkvMik7CiAgICBzY3JvbGxiYXIubWFrZUN1cnNvck5vcm1hbCgpOwogICAgc2Nyb2xsYmFyLmhlaWdodCggZ2V0QmFySCgpICk7CiAgICBiZ1Jvb3QuYWRkQ2hpbGQoc2Nyb2xsYmFyKTsKICAgIHZhciBzY3JvbGxEaXNNYXggPSBiZ1Jvb3QuaGVpZ2h0KCktc2Nyb2xsYmFyLmhlaWdodCgpOwogICAgdmFyIHNjcm9sbERpc01pbiA9IDA7CgoKCiAgICAvLy0tLS0tIGxldCBzY3JvbGwtYmFyIGF1dG8gaGlkZSAtLS0tLS8vCiAgICB2YXIgdGltZXJCYXJBdXRvSGlkZSA9IG51bGw7CiAgICBmdW5jdGlvbiBzY3JvbGxiYXJBbmlIaWRlKHYpIHsKICAgICAgICBpZiggIWlzSW5wdXRWYWxpZCh2KSB8fCBpc0lucHV0Qm9vbGVhbih2KSYmdj09dHJ1ZSApIHsKICAgICAgICAgICAgc2Nyb2xsYmFyLmFuaUJ5QWxwaGEoYmFyQW5pU3BlZWQsIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNjcm9sbGJhci5oaWRkZW4odHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzY3JvbGxiYXIuYWxwaGEoKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBzY3JvbGxiYXIuaGlkZGVuKGZhbHNlKTsKICAgICAgICAgICAgICAgIHNjcm9sbGJhci5hbmlCeUNTUyhiYXJBbmlTcGVlZCwge2FscGhhOiBiYXJBbHBoYX0sIGZhbHNlLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHN0YXJ0QmFyQXV0b0hpZGVUaW1lcih2KSB7CiAgICAgICAgaWYoICFpc0lucHV0VmFsaWQodikgfHwgaXNJbnB1dEJvb2xlYW4odikmJnY9PXRydWUgKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXJCYXJBdXRvSGlkZSk7CiAgICAgICAgICAgIHRpbWVyQmFyQXV0b0hpZGUgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzY3JvbGxiYXJBbmlIaWRlKCk7CiAgICAgICAgICAgICAgICBzdGFydEJhckF1dG9IaWRlVGltZXIoZmFsc2UpOwogICAgICAgICAgICB9LCBiYXJBdXRvSGlkZVRpbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXJCYXJBdXRvSGlkZSk7CiAgICAgICAgfQogICAgfQogICAgYmdSb290LmFkZE1vdXNlT3ZlcihmdW5jdGlvbihlKSB7Ci8vICAgICAgICAgICAgaWYoZS5mcm9tRWxlbWVudC5vZmZzZXRQYXJlbnQ9PW51bGwpICAvLyBvbmx5IHdvcmtzIGZvciBzYWZhcmkgYW5kIGNocm9tZSwgbm90IGZpcmVmb3gKICAgICAgICAvLy0tLS0tIHRoaXMgbWV0aG9kIG5vdCBwZXJmZWN0LCBjdXJzb3IgbW92ZXMgYnR3IG9iaiBvbiBiZ1Jvb3Qgd2lsbCBhbHNvIGNhbGwgdGhpcyBmdW5jIC0tLS0tLy8KLy8gICAgICAgICAgICBpZihlLnRhcmdldD09YmdTY3JvbGxCYXNlLm9ianx8ZS5mcm9tRWxlbWVudCYmZS5mcm9tRWxlbWVudC5vZmZzZXRQYXJlbnQ9PW51bGwpIHsKICAgICAgICBzY3JvbGxiYXJBbmlIaWRlKGZhbHNlKTsKICAgICAgICBzdGFydEJhckF1dG9IaWRlVGltZXIoKTsKLy8gICAgICAgICAgICB9CiAgICB9KTsKICAgIC8vLS0tLS0gbGV0IHNjcm9sbC1iYXIgYXV0byBoaWRlIC0tLS0tLy8KCgogICAgLy8tLS0tLSB3aGVuIGRyYWdnaW5nIHNjcm9sbC1iYXIgLS0tLS0vLwogICAgc2Nyb2xsYmFyLmFkZE1vdXNlRG93bihmdW5jdGlvbihlKSB7CiAgICAgICAgLy8tLS0tLSBzYXZlIG1vdXNlLXBvcyBhbmQgcmVhZHkgZm9yIGRyYWcgLS0tLS0vLwogICAgICAgIGxhc3RCYXJQb3NZID0gc2Nyb2xsYmFyLnRvcCgpOwogICAgICAgIGRyYWdQb3NZU3RhcnQgPSBzY3JvbGxiYXIudG9wKCkrZS5vZmZzZXRZK3l5OwogICAgICAgIGlzQWxsb3dEcmFnID0gdHJ1ZTsKICAgIH0pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbigpIHsKICAgICAgICAvLy0tLS0tIG5vdCBhbGxvdyBkcmFnIC0tLS0tLy8KICAgICAgICBpc0FsbG93RHJhZyA9IGZhbHNlOwogICAgICAgIC8vLS0tLS0gZG8gbm90IHN0YXJ0IGF1dG8gaGlkZSB0aW1lciB3aGVuIGN1cnNvciBzdGlsbCBvbiBzY3JvbGwtYmFyIC0tLS0tLy8KICAgICAgICBpZihzY3JvbGxiYXIud2lkdGgoKSE9YmFyV2lkdGhNYXgpCiAgICAgICAgICAgIHN0YXJ0QmFyQXV0b0hpZGVUaW1lcigpOwogICAgfSwgZmFsc2UpOwogICAgc2Nyb2xsYmFyLmFkZE1vdXNlT3ZlcihmdW5jdGlvbigpIHsKICAgICAgICAvLy0tLS0tIGxldCBiYXIgc2l6ZSBiaWdnZXIgZm9yIHVzZXIgZWFzeSB0byBkcmFnIC0tLS0tLy8KICAgICAgICBtYWtlQmFyQmlnZ2VyKHRydWUpOwogICAgfSk7CiAgICBzY3JvbGxiYXIuYWRkTW91c2VPdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgLy8tLS0tLSBsZXQgYmFyIHJldHVybiB0byBub3JtYWwtc2l6ZSAtLS0tLS8vCiAgICAgICAgbWFrZUJhckJpZ2dlcihmYWxzZSk7CiAgICB9KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYoIGlzQWxsb3dEcmFnICkgewoKICAgICAgICAgICAgZHJhZ1Bvc1lFbmQgPSBlLmNsaWVudFk7CiAgICAgICAgICAgIGRyYWdEaXMgPSAoZHJhZ1Bvc1lFbmQtZHJhZ1Bvc1lTdGFydCk7CiAgICAgICAgICAgIHNjcm9sbGJhci50b3AoIGxhc3RCYXJQb3NZK2RyYWdEaXMgKTsKCiAgICAgICAgICAgIC8vLS0tLS0gcmVzdHJpY3QgYmFyJ3MgbW92ZSBhcmVhIC0tLS0tLy8KICAgICAgICAgICAgaWYoIHNjcm9sbGJhci50b3AoKT5zY3JvbGxEaXNNYXggKSB7CiAgICAgICAgICAgICAgICBzY3JvbGxiYXIudG9wKCBzY3JvbGxEaXNNYXggKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggc2Nyb2xsYmFyLnRvcCgpPHNjcm9sbERpc01pbiApIHsKICAgICAgICAgICAgICAgIHNjcm9sbGJhci50b3AoIHNjcm9sbERpc01pbiApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLy0tLS0tIGFwcGx5IGJhcidzIGRyYWctZGlzIHRvIHNjcm9sbEJhc2UgLS0tLS0vLwogICAgICAgICAgICBiZ1Njcm9sbEJhc2Uub2JqLnNjcm9sbFRvcCA9IHNjcm9sbGJhci50b3AoKSooY29udGVudC5oZWlnaHQoKS9iZ1Njcm9sbEJhc2UuaGVpZ2h0KCkpOwogICAgICAgIH0KICAgIH0sIGZhbHNlKTsKICAgIC8vLS0tLS0gd2hlbiBkcmFnZ2luZyBzY3JvbGwtYmFyIC0tLS0tLy8KCiAgICAvLy0tLS0tIGRldGVjdCBtb3VzZS13aGVlbCBhbmQgbW92ZSBzY3JvbGwtYmFyIC0tLS0tLy8KICAgIGJnU2Nyb2xsQmFzZS5vYmouYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHBvc3kgPSBiZ1Njcm9sbEJhc2UuaGVpZ2h0KCkqKGJnU2Nyb2xsQmFzZS5vYmouc2Nyb2xsVG9wL2NvbnRlbnQuaGVpZ2h0KCkpOwogICAgICAgIHNjcm9sbGJhci50b3AocG9zeSk7CgogICAgICAgIC8vLS0tLS0gc2hvdyBiYXIgd2hlbiBzY3JvbGwtd2hlZWwgLS0tLS0vLwogICAgICAgIHNjcm9sbGJhckFuaUhpZGUoZmFsc2UpOwogICAgICAgIC8vLS0tLS0gZG8gbm90IHN0YXJ0IGF1dG8gaGlkZSB0aW1lciB3aGVuIGRyYWdnaW5nIC0tLS0tLy8KICAgICAgICBpZiggIWlzQWxsb3dEcmFnICkKICAgICAgICAgICAgc3RhcnRCYXJBdXRvSGlkZVRpbWVyKCk7CiAgICB9KTsKCgoKCgogICAgdXBkYXRlU2Nyb2xsU3RhdGUoKTsKICAgIHN0YXJ0QmFyQXV0b0hpZGVUaW1lcigpOwoKfQoKCmZ1bmN0aW9uIEFsZXJ0KHRpdGxlLG9uQnRuT0ssb25CdG5DYW5jZWwsb25NYXNrQ2xpY2spIHsKCgogICAgdmFyIG1hc2tBbHBoYSA9IC43OwogICAgZnVuY3Rpb24gcmVtb3ZlQWxlcnQoKSB7CiAgICAgICAgdDEucmVtb3ZlRnJvbVBhcmVudCgpOwogICAgICAgIHQxID0gbnVsbDsKICAgICAgICB2MS5yZW1vdmVGcm9tUGFyZW50KCk7CiAgICAgICAgdjEgPSBudWxsOwogICAgICAgIGJnLnJlbW92ZUZyb21QYXJlbnQoKTsKICAgICAgICBiZyA9IG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiBmYWRlT3V0QW5kUmVtb3ZlKCkgewogICAgICAgIGJnLmFuaUJ5QWxwaGEoLjEsMCxmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJlbW92ZUFsZXJ0KCk7CiAgICAgICAgfSk7CiAgICB9CiAgICB2YXIgYmcgPSBuZXcgU3ByaXRlKCk7CiAgICBiZy5pbml0RGl2KCk7CiAgICBiZy50b3AoMCk7CiAgICBiZy5sZWZ0KDApOwogICAgYmcud2lkdGgoIjEwMCUiKTsKICAgIGJnLmhlaWdodCgiMTAwJSIpOwogICAgYmcuYXBwbHlaSW5kZXgoOTkpOwogICAgdmFyIG1hc2sgPSBuZXcgU3ByaXRlKCk7CiAgICBtYXNrLmluaXREaXYoKTsKICAgIG1hc2sudG9wKDApOwogICAgbWFzay5sZWZ0KDApOwogICAgbWFzay53aWR0aCgiMTAwJSIpOwogICAgbWFzay5oZWlnaHQoIjEwMCUiKTsKICAgIG1hc2suY29sb3IoMCwwLDApOwogICAgbWFzay5hbHBoYSgwKTsKICAgIG1hc2suYWRkTW91c2VDbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYoIGlzSW5wdXRWYWxpZChvbk1hc2tDbGljaykmJmlzSW5wdXRGdW5jVHlwZShvbk1hc2tDbGljaykgKSB7CiAgICAgICAgICAgIG9uTWFza0NsaWNrKCk7CiAgICAgICAgfQogICAgICAgIGZhZGVPdXRBbmRSZW1vdmUoKTsKICAgIH0pOwogICAgdmFyIHYxID0gbmV3IFNwcml0ZSgpOwogICAgdjEuaW5pdERpdigpOwogICAgdjEud2lkdGgoNDAwKTsKICAgIHYxLmhlaWdodCgyMzApOwogICAgdjEuY29sb3JIZXgoImY2ZjZmNiIpOwogICAgdjEuY29ybmVyUmFkaXVzKDEyKTsKICAgIHYxLmFsaWduQ2VudGVyKCk7CiAgICB2MS50b3AodjEuY29udGVudFRvcCgpLTUwKTsKICAgIHYxLnNoYWRvdygwLDAsMTUsLjYpOwogICAgdjEuYWxwaGEoMCk7CgoKICAgIC8vLS0tLS0gYWxlcnQncyBjb250ZW50IGhlcmUgLS0tLS0vLwogICAgdmFyIGJvcmRlckRpcyA9IDE4OwogICAgdmFyIGJ0bkJvcmRlckRpcyA9IDY7CiAgICB2YXIgYnRuSGVpZ2h0ID0gNjA7CiAgICB2YXIgdDEgPSBuZXcgU3ByaXRlKCk7CiAgICB0MS5pbml0RGl2KCk7CiAgICB2YXIgc2FmZUhlaWdodCA9IHYxLmhlaWdodCgpLWJvcmRlckRpcyoyLTYtNjA7CiAgICB0MS5mcmFtZShib3JkZXJEaXMsYm9yZGVyRGlzLHYxLndpZHRoKCktYm9yZGVyRGlzKjIsbnVsbCk7CiAgICB0MS5hcHBseVRleHQodGl0bGUpOwogICAgdDEudGV4dFNpemUoMjYpOwogICAgdDEudGV4dENvbG9yKCI1YzVjNWMiKTsKICAgIHQxLm9iai5zdHlsZS5saW5lSGVpZ2h0ID0gJzI4cHgnOwogICAgLy8tLS0tLSBjaGVjayBjb250ZW50J3MgaGVpZ2h0IGV4Y2VlZCBkaWFsb2d1ZSBkZWZhdWx0IGhlaWdodCAtLS0tLS8vCiAgICBpZiggdDEuY29udGVudEhlaWdodCgpPHNhZmVIZWlnaHQgKSB7CiAgICAgICAgdDEudG9wKGJvcmRlckRpcysoc2FmZUhlaWdodC8yKS10MS5jb250ZW50SGVpZ2h0KCkvMik7CiAgICAgICAgdmFyIGhvd01hbnlMaW5lcyA9IHQxLmNvbnRlbnRIZWlnaHQoKS9wYXJzZUludCh0MS5vYmouc3R5bGUubGluZUhlaWdodC5yZXBsYWNlKCdweCcsJycpKTsKICAgICAgICAvLy0tLS0tIGlmIGNvbnRlbnQgb25seSAxIGxpbmUsIG1ha2UgdGV4dCBhbGlnbiBjZW50ZXIgLS0tLS0vLwogICAgICAgIGlmKCBob3dNYW55TGluZXMgPD0gMSApIHsKICAgICAgICAgICAgdDEudGV4dEFsaWduQ2VudGVyKCk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICAvLy0tLS0tIGNvbnRlbnQncyBoZWlnaHQgZXhjZWVkIGRpYWxvZ3VlIGhlaWdodCwgbWFrZSBkaWFsb2d1ZSBiaWdnZXIgLS0tLS0vLwogICAgICAgIHYxLmhlaWdodCh0MS5jb250ZW50SGVpZ2h0KCkrYm9yZGVyRGlzKjIrYnRuQm9yZGVyRGlzKjIrYnRuSGVpZ2h0KTsKICAgIH0KICAgIC8vIHZhciBiYiA9IG5ldyBTcHJpdGUoKTsKICAgIC8vIGJiLmluaXREaXYoKTsKICAgIC8vIGJiLmZyYW1lKGJvcmRlckRpcyxib3JkZXJEaXMsdDEud2lkdGgoKSxzYWZlSGVpZ2h0KTsKICAgIC8vIGJiLmNvbG9ySGV4KCc5OTAwMDAnKTsKICAgIC8vIHYxLmFkZENoaWxkKGJiKTsKCiAgICBiZy5hZGRDaGlsZChtYXNrKTsKICAgIGJnLmFkZENoaWxkKHYxKTsKICAgIHYxLmFkZENoaWxkKHQxKTsKCiAgICBtYXNrLmFuaUJ5QWxwaGEoLjEsbWFza0FscGhhLG51bGwpOwogICAgdjEuYW5pQnlBbHBoYSguMiwxLG51bGwpOwogICAgdjEuYW5pX3koLjIsdjEudG9wKCktNTAsZmFsc2UsbnVsbCxudWxsKTsKCiAgICBmdW5jdGlvbiBhZGRCdG5CeUNvdW50KHYpIHsKICAgICAgICB2YXIgZGlzID0gNjsKICAgICAgICB2YXIgY29sb3JHcmVlbiA9ICIyM2I1NzQiOwogICAgICAgIHZhciBjb2xvckJsdWUgPSAiMjNiNWIzIjsKICAgICAgICB2YXIgY29sb3JPdmVyID0gIjAwOTY1MyI7CiAgICAgICAgdmFyIGNvbG9yRG93biA9ICJmZmE4MDAiOwogICAgICAgIHZhciBidG5UZXh0U2l6ZSA9IDI2OwogICAgICAgIHZhciBidG5Db3JuZXJSID0gNjsKICAgICAgICBzd2l0Y2godikgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB2YXIgYjEgPSBuZXcgU3ByaXRlKCk7CiAgICAgICAgICAgICAgICBiMS5pbml0QnRuKCLnorog5a6aIik7CiAgICAgICAgICAgICAgICBiMS5ib3R0b20oZGlzKTsKICAgICAgICAgICAgICAgIGIxLmxlZnQoZGlzKTsKICAgICAgICAgICAgICAgIGIxLndpZHRoKHYxLndpZHRoKCktZGlzKjIpOwogICAgICAgICAgICAgICAgYjEuaGVpZ2h0KGJ0bkhlaWdodCk7CiAgICAgICAgICAgICAgICBiMS5jb2xvckhleChjb2xvckdyZWVuKTsKICAgICAgICAgICAgICAgIGIxLmNvcm5lclJhZGl1cyhidG5Db3JuZXJSKTsKICAgICAgICAgICAgICAgIGIxLnRleHRDb2xvcigiZmZmZmZmIik7CiAgICAgICAgICAgICAgICBiMS50ZXh0U2l6ZShidG5UZXh0U2l6ZSk7CiAgICAgICAgICAgICAgICBiMS5hZGRNb3VzZU92ZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGIxLmNvbG9ySGV4KGNvbG9yT3Zlcik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGIxLmFkZE1vdXNlT3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBiMS5jb2xvckhleChjb2xvckdyZWVuKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYjEuYWRkTW91c2VEb3duKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBiMS5jb2xvckhleChjb2xvckRvd24pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiMS5hZGRNb3VzZVVwKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBiMS5jb2xvckhleChjb2xvckdyZWVuKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYjEuYWRkTW91c2VDbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoIGlzSW5wdXRGdW5jVHlwZShvbkJ0bk9LKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgb25CdG5PSygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmYWRlT3V0QW5kUmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHYxLmFkZENoaWxkKGIxKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB2YXIgYjEgPSBuZXcgU3ByaXRlKCk7CiAgICAgICAgICAgICAgICBiMS5pbml0QnRuKCLnorog5a6aIik7CiAgICAgICAgICAgICAgICBiMS5ib3R0b20oZGlzKTsKICAgICAgICAgICAgICAgIGIxLnJpZ2h0KGRpcyk7CiAgICAgICAgICAgICAgICBiMS53aWR0aCh2MS53aWR0aCgpLzItZGlzKjEuNSk7CiAgICAgICAgICAgICAgICBiMS5oZWlnaHQoYnRuSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGIxLmNvbG9ySGV4KGNvbG9yR3JlZW4pOwogICAgICAgICAgICAgICAgYjEuY29ybmVyUmFkaXVzKGJ0bkNvcm5lclIpOwogICAgICAgICAgICAgICAgYjEudGV4dENvbG9yKCJmZmZmZmYiKTsKICAgICAgICAgICAgICAgIGIxLnRleHRTaXplKGJ0blRleHRTaXplKTsKICAgICAgICAgICAgICAgIGIxLmFkZE1vdXNlT3ZlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgYjEuY29sb3JIZXgoY29sb3JPdmVyKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYjEuYWRkTW91c2VPdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGIxLmNvbG9ySGV4KGNvbG9yR3JlZW4pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiMS5hZGRNb3VzZURvd24oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGIxLmNvbG9ySGV4KGNvbG9yRG93bik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGIxLmFkZE1vdXNlVXAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGIxLmNvbG9ySGV4KGNvbG9yR3JlZW4pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiMS5hZGRNb3VzZUNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiggaXNJbnB1dEZ1bmNUeXBlKG9uQnRuT0spICkgewogICAgICAgICAgICAgICAgICAgICAgICBvbkJ0bk9LKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZhZGVPdXRBbmRSZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdjEuYWRkQ2hpbGQoYjEpOwogICAgICAgICAgICAgICAgdmFyIGIyID0gbmV3IFNwcml0ZSgpOwogICAgICAgICAgICAgICAgYjIuaW5pdEJ0bigi5Y+WIOa2iCIpOwogICAgICAgICAgICAgICAgYjIuYm90dG9tKGRpcyk7CiAgICAgICAgICAgICAgICBiMi5sZWZ0KGRpcyk7CiAgICAgICAgICAgICAgICBiMi53aWR0aCh2MS53aWR0aCgpLzItZGlzKjEuNSk7CiAgICAgICAgICAgICAgICBiMi5oZWlnaHQoYnRuSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGIyLmNvbG9ySGV4KGNvbG9yQmx1ZSk7CiAgICAgICAgICAgICAgICBiMi5jb3JuZXJSYWRpdXMoYnRuQ29ybmVyUik7CiAgICAgICAgICAgICAgICBiMi50ZXh0Q29sb3IoImZmZmZmZiIpOwogICAgICAgICAgICAgICAgYjIudGV4dFNpemUoYnRuVGV4dFNpemUpOwogICAgICAgICAgICAgICAgYjIuYWRkTW91c2VPdmVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBiMi5jb2xvckhleCgiMWE4NzhiIik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGIyLmFkZE1vdXNlT3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBiMi5jb2xvckhleChjb2xvckJsdWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiMi5hZGRNb3VzZURvd24oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGIyLmNvbG9ySGV4KGNvbG9yRG93bik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGIyLmFkZE1vdXNlVXAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGIyLmNvbG9ySGV4KGNvbG9yQmx1ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGIyLmFkZE1vdXNlQ2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmKCBpc0lucHV0RnVuY1R5cGUob25CdG5DYW5jZWwpICkgewogICAgICAgICAgICAgICAgICAgICAgICBvbkJ0bkNhbmNlbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmYWRlT3V0QW5kUmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHYxLmFkZENoaWxkKGIyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICAgIGlmKCBpc0lucHV0VmFsaWQob25CdG5PSykgJiYgaXNJbnB1dFZhbGlkKG9uQnRuQ2FuY2VsKSYmaXNJbnB1dEZ1bmNUeXBlKG9uQnRuQ2FuY2VsKSApIHsKICAgICAgICBhZGRCdG5CeUNvdW50KDIpOwogICAgfSBlbHNlIHsKICAgICAgICBhZGRCdG5CeUNvdW50KDEpOwogICAgfQoKfQoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogKiBUaXBCb3gKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogRVg6IG5ldyBUaXBCb3goe3RyaURpcmVjdGlvbjowLHg6c3BhY2VXLHk6c3BhY2VILHc6NDAwLGg6MTAwLHRyaWFuZ2xlVzozMCx0cmlhbmdsZUg6MjAsCiAgICBiZ0NvbG9yOicwMDk5MDAnLGNvcm5lclI6MTAsdGlwOidFQVJUSCBTUE9UPWxvdmXmhJvlnLDnkIMnLHRleHRDb2xvcjonZmZmZmZmJyx0ZXh0U2l6ZTonMjUnLAogICAgaXNUcmlUb3BQb3M6dHJ1ZSxpc1NoYWRvdzp0cnVlLHNoYWRvd0RpczoyMixzaGFkb3dBbHBoYTouN30pOwogKgogKiBUcmlhbmdsZS1EaXJlY3Rpb246IDAtTm9ydGgsMS1FYXN0LDItU291dGgsMy1XZXN0CiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCmZ1bmN0aW9uIFRpcEJveCh2KSB7CgogICAgdmFyIHh4ID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi54KT92Lng6MTAwOwogICAgdmFyIHl5ID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi55KT92Lnk6MTAwOwogICAgdmFyIHd3ID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi53KT92Lnc6MjAwOwogICAgdmFyIGhoID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi5oKT92Lmg6NTA7CiAgICAvLy0tLS0tIHRyaWFuZ2xlJ3MgZGlyZWN0aW9uOm5vcnRoLGVhc3Qsc291dGgsd2VzdCAvIDAsMSwyLDMgLS0tLS0vLwogICAgdmFyIHRyaURpcmVjdGlvbiA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYudHJpRGlyZWN0aW9uKT92LnRyaURpcmVjdGlvbjowOwogICAgLy8tLS0tLSBzaGFwZSB0cmlhbmdsZSAtLS0tLS8vCiAgICB2YXIgdHJpYW5nbGVXID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi50cmlhbmdsZVcpP3YudHJpYW5nbGVXOjIwOwogICAgdmFyIHRyaWFuZ2xlSCA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYudHJpYW5nbGVIKT92LnRyaWFuZ2xlSDoxMDsKICAgIHZhciBiZ0NvbG9yID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi5iZ0NvbG9yKT92LmJnQ29sb3I6JzRlODg2Zic7CiAgICB2YXIgY29ybmVyUiA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYuY29ybmVyUik/di5jb3JuZXJSOic3JzsKICAgIHZhciB0aXAgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LnRpcCk/di50aXA6J01FU1NBR0UgSEVSRSc7CiAgICB2YXIgdGV4dENvbG9yID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi50ZXh0Q29sb3IpP3YudGV4dENvbG9yOidmZmZmZmYnOwogICAgdmFyIHRleHRTaXplID0gaXNJbnB1dFZhbGlkKHYpJiZpc0lucHV0VmFsaWQodi50ZXh0U2l6ZSk/di50ZXh0U2l6ZTonMjAnOwogICAgLy8tLS0tLSBsZXQgeCx5IHBvcyBiZWNvbWUgdGlwLWJveCdzIHRyaWFuZ2xlIHRvcCBwb3NpdGlvbiAtLS0tLS8vCiAgICB2YXIgaXNUcmlUb3BQb3MgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LmlzVHJpVG9wUG9zKT92LmlzVHJpVG9wUG9zOnRydWU7CiAgICAvLy0tLS0tIGFkZCBzaGFkb3cgaGVyZSAtLS0tLS8vCiAgICB2YXIgaXNTaGFkb3cgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LmlzU2hhZG93KT92LmlzU2hhZG93OmZhbHNlOwogICAgdmFyIHNoYWRvd0RpcyA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYuc2hhZG93RGlzKT92LnNoYWRvd0RpczoxNTsKICAgIHZhciBzaGFkb3dBbHBoYSA9IGlzSW5wdXRWYWxpZCh2KSYmaXNJbnB1dFZhbGlkKHYuc2hhZG93QWxwaGEpP3Yuc2hhZG93QWxwaGE6Ljg7CgoKICAgIC8vLS0tLS0gcm9vbSBzcGFjZSBmb3IgYWRkaW5nIHNoYWRvdyBvbiBiZ0Nvcm5lciAtLS0tLS8vCiAgICB2YXIgc2hhZG93U3BhY2UgPSBpc0lucHV0VmFsaWQodikmJmlzSW5wdXRWYWxpZCh2LnNoYWRvd0Rpcyk/di5zaGFkb3dEaXMqMjoyMDsKCgogICAgdmFyIGJnUm9vdCA9IG5ldyBTcHJpdGUoKTsKICAgIGJnUm9vdC5pbml0RGl2KCk7CiAgICBiZ1Jvb3QuZnJhbWUoeHgseXksd3crc2hhZG93U3BhY2UsaGgrc2hhZG93U3BhY2UpOwogICAgLy8tLS0tLSBERUJVRyBVU0FHRSAtLS0tLS8vCi8vICAgICAgICBiZ1Jvb3QuY29sb3JIZXgoJzAwMDAwMCcpO2JnUm9vdC5hbHBoYSguNSk7CiAgICAvLy0tLS0tIERFQlVHIFVTQUdFIC0tLS0tLy8KCiAgICB2YXIgYmdDb3JuZXIgPSBuZXcgU3ByaXRlKCk7CiAgICBiZ0Nvcm5lci5pbml0RGl2KCk7CiAgICBiZ0Nvcm5lci5mcmFtZSgwLDAsd3csaGgpOwogICAgYmdDb3JuZXIuY29sb3JIZXgoYmdDb2xvcik7CiAgICBiZ0Nvcm5lci5jb3JuZXJSYWRpdXMoY29ybmVyUik7CiAgICBiZ1Jvb3QuYWRkQ2hpbGQoYmdDb3JuZXIpOwoKICAgIHZhciBzaGFwZVRyaSA9IG5ldyBTcHJpdGUoKTsKICAgIHNoYXBlVHJpLmluaXRUcmlhbmdsZShudWxsLHRyaWFuZ2xlVyx0cmlhbmdsZUgsYmdDb2xvcik7CiAgICAvLy0tLS0tIERFQlVHIFVTQUdFIC0tLS0tLy8KLy8gICAgICAgIHNoYXBlVHJpLmNvbG9ySGV4KCcwMDAwOTknKTsKICAgIC8vLS0tLS0gREVCVUcgVVNBR0UgLS0tLS0vLwogICAgLy8tLS0tLSBzZXQgcm90YXRlJ3Mgb3JpZ2luIHRvIGxlZnQtdG9wIGNvcm5lciAtLS0tLS8vCiAgICBzaGFwZVRyaS5vYmouc3R5bGUuY3NzVGV4dCArPSAndHJhbnNmb3JtLW9yaWdpbjowJSAwJTsnOwogICAgYmdSb290LmFkZENoaWxkKHNoYXBlVHJpKTsKICAgIHN3aXRjaCggdHJpRGlyZWN0aW9uICkgewogICAgICAgIGNhc2UgMDogICAgIC8vIE4KICAgICAgICAgICAgYmdSb290LmhlaWdodCh0cmlhbmdsZUgraGgrc2hhZG93U3BhY2UpOwogICAgICAgICAgICBzaGFwZVRyaS5yb3RhdGUoMCk7CiAgICAgICAgICAgIHNoYXBlVHJpLnRvcChzaGFkb3dTcGFjZS8yKTsKICAgICAgICAgICAgc2hhcGVUcmkubGVmdChiZ1Jvb3Qud2lkdGgoKS8yLXRyaWFuZ2xlVy8yKTsKICAgICAgICAgICAgYmdDb3JuZXIudG9wKHNoYXBlVHJpLnRvcCgpK3RyaWFuZ2xlSCk7CiAgICAgICAgICAgIGJnQ29ybmVyLmxlZnQoc2hhZG93U3BhY2UvMik7CiAgICAgICAgICAgIGxldFRyaWFuZ2xlVG9wQmVjb21lWFlQb3MoMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTogICAgIC8vIEUKICAgICAgICAgICAgYmdSb290LndpZHRoKHNoYWRvd1NwYWNlK3d3K3RyaWFuZ2xlSCk7CiAgICAgICAgICAgIHNoYXBlVHJpLnJvdGF0ZSg5MCk7CiAgICAgICAgICAgIHNoYXBlVHJpLmxlZnQoYmdSb290LndpZHRoKCktc2hhZG93U3BhY2UvMik7c2hhcGVUcmkudG9wKGJnUm9vdC5oZWlnaHQoKS8yLXRyaWFuZ2xlVy8yKTsKICAgICAgICAgICAgYmdDb3JuZXIubGVmdChzaGFkb3dTcGFjZS8yKTtiZ0Nvcm5lci50b3Aoc2hhZG93U3BhY2UvMik7CiAgICAgICAgICAgIGxldFRyaWFuZ2xlVG9wQmVjb21lWFlQb3MoMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjogICAgIC8vIFMKICAgICAgICAgICAgYmdSb290LmhlaWdodChzaGFkb3dTcGFjZStoaCt0cmlhbmdsZUgpOwogICAgICAgICAgICBiZ0Nvcm5lci5sZWZ0KHNoYWRvd1NwYWNlLzIpO2JnQ29ybmVyLnRvcChzaGFkb3dTcGFjZS8yKTsKICAgICAgICAgICAgc2hhcGVUcmkucm90YXRlKDE4MCk7CiAgICAgICAgICAgIHNoYXBlVHJpLnRvcChiZ1Jvb3QuaGVpZ2h0KCktc2hhZG93U3BhY2UvMik7CiAgICAgICAgICAgIHNoYXBlVHJpLmxlZnQoYmdSb290LndpZHRoKCkvMit0cmlhbmdsZVcvMik7CiAgICAgICAgICAgIGxldFRyaWFuZ2xlVG9wQmVjb21lWFlQb3MoMik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzogICAgIC8vIFcKICAgICAgICAgICAgYmdSb290LndpZHRoKHNoYWRvd1NwYWNlK3d3K3RyaWFuZ2xlSCk7CiAgICAgICAgICAgIHNoYXBlVHJpLnJvdGF0ZSgtOTApOwogICAgICAgICAgICBzaGFwZVRyaS5sZWZ0KHNoYWRvd1NwYWNlLzIpOwogICAgICAgICAgICBzaGFwZVRyaS50b3AoYmdSb290LmhlaWdodCgpLzIrdHJpYW5nbGVXLzIpOwogICAgICAgICAgICBiZ0Nvcm5lci5sZWZ0KHRyaWFuZ2xlSCtzaGFkb3dTcGFjZS8yKTsKICAgICAgICAgICAgYmdDb3JuZXIuYWxpZ25DZW50ZXJWZXJ0aWNhbCgpOwogICAgICAgICAgICBsZXRUcmlhbmdsZVRvcEJlY29tZVhZUG9zKDMpOwogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICB2YXIgdGV4dCA9IG5ldyBTcHJpdGUoKTsKICAgIHRleHQuaW5pdERpdigpOwogICAgdGV4dC5mcmFtZSgwLDAsYmdDb3JuZXIud2lkdGgoKSxiZ0Nvcm5lci5oZWlnaHQoKSk7CiAgICB0ZXh0LmFwcGx5VGV4dCh0aXApOwogICAgdGV4dC5tYWtlQ3Vyc29yTm9ybWFsKGZhbHNlKTsKICAgIHRleHQudGV4dENvbG9yKHRleHRDb2xvcik7CiAgICB0ZXh0LnRleHRTaXplKHRleHRTaXplKTsKICAgIHRleHQudGV4dEFsaWduQ2VudGVyKCk7CiAgICBiZ0Nvcm5lci5hZGRDaGlsZCh0ZXh0KTsKCgogICAgZnVuY3Rpb24gbGV0VHJpYW5nbGVUb3BCZWNvbWVYWVBvcyh2KSB7CiAgICAgICAgaWYoIGlzVHJpVG9wUG9zICkgewogICAgICAgICAgICBzd2l0Y2ggKHYpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBiZ1Jvb3QubGVmdCh4eC1iZ1Jvb3Qud2lkdGgoKS8yKTsKICAgICAgICAgICAgICAgICAgICBiZ1Jvb3QudG9wKGJnUm9vdC50b3AoKS1zaGFkb3dTcGFjZS8yKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBiZ1Jvb3QudG9wKGJnUm9vdC50b3AoKS1iZ1Jvb3QuaGVpZ2h0KCkvMik7CiAgICAgICAgICAgICAgICAgICAgYmdSb290LmxlZnQoYmdSb290LmxlZnQoKS0oc2hhZG93U3BhY2UvMitiZ0Nvcm5lci53aWR0aCgpK3RyaWFuZ2xlSCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGJnUm9vdC50b3AoYmdSb290LnRvcCgpLShzaGFkb3dTcGFjZS8yK2JnQ29ybmVyLmhlaWdodCgpK3RyaWFuZ2xlSCkpOwogICAgICAgICAgICAgICAgICAgIGJnUm9vdC5sZWZ0KGJnUm9vdC5sZWZ0KCktYmdSb290LndpZHRoKCkvMik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgYmdSb290LnRvcChiZ1Jvb3QudG9wKCktYmdSb290LmhlaWdodCgpLzIpOwogICAgICAgICAgICAgICAgICAgIGJnUm9vdC5sZWZ0KGJnUm9vdC5sZWZ0KCktc2hhZG93U3BhY2UvMik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8tLS0tLSBhZGQgc2hhZG93IGhlcmUgLS0tLS0vLwogICAgaWYoIGlzU2hhZG93ICkgewogICAgICAgIGJnQ29ybmVyLnNoYWRvdygwLDAsc2hhZG93RGlzLHNoYWRvd0FscGhhKTsKICAgIH0KCiAgICB0aGlzLmJnID0gYmdSb290OwogICAgLy8tLS0tLSBFTkQgT0YgVElQIC0tLS0tLy8KfQ==';
    // var ss = 'Ly8tLS0tLS0tLS0tLS0tIFNQUklURSBDTEFTUyAtLS0tLS0tLS0tLS0tLS0tLy8KZnVuY3Rpb24gYXBwbGUoKXsKLy8gaGVsbG8gd29ybGQKfQovKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiBBY2NvcmRpbmcgdG8gbG9hZCB0ZXh0IGZpbGUgZnJvbSBsb2NhbCBoYXZpbmcgc2VjdXJpdHkgcHJvYmxlbXMsIHN0YXRpYyBqcyBmcm9tIGhlcmUKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KZnVuY3Rpb24gc3VuKCl7Ci8vY29tbWVudCBsaW5lIGhlcmUKdmFyIGFhID0gJyc7CnZhciBiYiA9ICcnOwp9Ci8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogUFJPQkxFTVMoMjAxN0phbik6CiAqIDEpIE5vdG9TYW5zVEMgaXMgbm90IGFzIGdvb2QgYXMgd2UgdGhvdWdoIGluIGJyb3dzZXIncyBmb250IGRpc3BsYXkKICogMikgVGhpcyBmb250IGxldCBzbWFsbCB0ZXh0IGRpc3BsYXkgd2VsbCwgd2lsbCB0ZXN0IGluIGZ1dHVyZQogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqIDEpIEJlZm9yZSBOb3RvU2Fuc1RDIGxvYWRlZCwgdXNpbmcgdXNlcidzIGxvY2FsIGZvbnQgZm9yIGRlZmF1bHQKICogMikgV2hlbiBOb3RvU2Fuc1RDIGxvYWQgZG9uZSwgbWFrZSBOb3RvU2Fuc1RDIGZvciBkZWZhdWx0IGZvbnQgYXV0b21hdGljYWxseQogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSov';
    //----- return base64 decoded -----//
    return atob(ss);
}




/**--------------------------------------------------------------------------------------
 * DEBUG-USAGE: Show any result on sprite-text-view
---------------------------------------------------------------------------------------*/
function showResultOnScreen(v) {
    var textView = new Sprite();
    textView.initTextArea();
    textView.frame(0,0,700,500);
    textView.colorHex('009900');
    textView.textColor('FFFFFF');
    textView.textSize('16');
    textView.applyText(v);
}





///**--------------------------------------------------------------------------------------
// * DEPRECATED - Try to load text file from local, but having security problems
//---------------------------------------------------------------------------------------*/
////----- input btn on screen for open local file -----//
//document.getElementById('fileInput').addEventListener('change', readSingleFile, false);
//
////----- loaded local-file -----//
//var localFileBcore = '';
//var localFile = '';
//
//
////----- for increase test speed, we load local js directly, testonly -----//
////----- localFile should init by input and readSingleFile -----//
//readLocalFileByPath('../_com/bcore.js', function (v) {
//    //        localFileBcore = v;
//    encryptBcoreJs(v, function (v) {
//        localFileBcore = v;
//        readLocalFileByPath('./PushTarget.js', function (v) {
//            encryptTargetJs(v, localFileBcore);
//        });
//    });
//});
///**----------------------------------------------------------------
// * Read file from local path
//-----------------------------------------------------------------*/
//function readLocalFileByPath(path, func) {
//    var client = new XMLHttpRequest();
//    client.open('GET', path, true);
//    client.onreadystatechange = function () {
//        if (this.readyState == 4 && this.status == 200) {
//            func(client.responseText);
//        }
//    };
//    client.send();
//}
//function autoStartDownload(data, filename, type) {
//    var a = document.createElement("a"),
//        file = new Blob([data], {
//            type: type
//        });
//    if (window.navigator.msSaveOrOpenBlob) // IE10+
//        window.navigator.msSaveOrOpenBlob(file, filename);
//    else { // Others
//        var url = URL.createObjectURL(file);
//        a.href = url;
//        a.download = filename;
//        document.body.appendChild(a);
//        a.click();
//        setTimeout(function () {
//            document.body.removeChild(a);
//            window.URL.revokeObjectURL(url);
//        }, 0);
//    }
//}
//function readSingleFile(e) {
//
//    var file = e.target.files[0];
//    if (!file) {
//        return;
//    }
//    var reader = new FileReader();
//    reader.onload = function (e) {
//        localFile = e.target.result;
//        analysisLoadedFile();
//    };
//    reader.readAsText(file);
//}
